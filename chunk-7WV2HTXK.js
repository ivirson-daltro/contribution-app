import{a as I}from"./chunk-RRN4R6SS.js";import{a as Z}from"./chunk-KRHYTJSD.js";import{a as X}from"./chunk-3YSMFNOC.js";import{c as z}from"./chunk-AUBPLCKN.js";import{a as q,b as G}from"./chunk-22VHZYS6.js";import{c as J,g as K}from"./chunk-LJVE3DC3.js";import{a as W}from"./chunk-2J3QXTNU.js";import{c as O,g as V,k as L,t as A}from"./chunk-MUXJUY4Y.js";import{a as H,b as Q}from"./chunk-LF2PKW2K.js";import{a as j,b as $}from"./chunk-ATKN46PQ.js";import{M as Y}from"./chunk-D735FC2V.js";import{$ as u,$a as S,Ab as f,Bb as y,Cb as R,Db as D,E as h,Eb as N,Gb as F,Ia as T,Lb as w,Nb as k,W as x,Wa as g,Ya as _,_ as b,_a as P,ab as E,bb as M,cb as o,db as n,eb as p,ib as C,kb as c,kc as B,lb as s,xb as v,xc as U,ya as m,zb as r}from"./chunk-2AFPZVH2.js";import"./chunk-7CGTOI24.js";var te=(a,i)=>i.id;function ie(a,i){if(a&1&&p(0,"mat-icon",26),a&2){let e=s();M("fontIcon",F(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function ne(a,i){a&1&&(o(0,"th",27),r(1,"A\xE7\xF5es"),n())}function oe(a,i){a&1&&(o(0,"tr")(1,"td",32),r(2," Nenhum membro encontrado. "),n()())}function re(a,i){if(a&1){let e=C();o(0,"td",27)(1,"button",33),c("click",function(){b(e);let l=s().$implicit,d=s(2);return u(d.editMember(l.id))}),p(2,"mat-icon",34),n(),o(3,"button",35),c("click",function(){b(e);let l=s().$implicit,d=s(2);return u(d.deleteMember(l.id))}),p(4,"mat-icon",36),n()()}}function ae(a,i){if(a&1&&(o(0,"tr")(1,"td"),r(2),n(),o(3,"td"),r(4),n(),o(5,"td"),r(6),w(7,"mask"),n(),o(8,"td"),r(9),n(),o(10,"td"),r(11),w(12,"date"),n(),g(13,re,5,0,"td",27),n()),a&2){let e=i.$implicit,t=s(2);m(2),f(e.name),m(2),f(e.memberType.description),m(2),f(k(7,6,e.phone??"","(00) 0 0000-0000")),m(3),f(e.email),m(2),f(k(12,9,e.birthDate,"dd/MM/yyyy")),m(2),_((t.user==null?null:t.user.role)===t.userRoles.ADMIN||(t.user==null?null:t.user.role)===t.userRoles.TREASURER||(t.user==null?null:t.user.role)===t.userRoles.SECRETARY?13:-1)}}function le(a,i){if(a&1&&S(0,ae,14,12,"tr",null,te),a&2){let e=s();E(e.members)}}function me(a,i){if(a&1){let e=C();o(0,"li",38)(1,"button",41),c("click",function(){let l=b(e).$implicit,d=s(2);return u(d.goToPage(l))}),r(2),n()()}if(a&2){let e=i.$implicit,t=s(2);v("active",t.pageIndex===e),m(2),y(" ",e+1," ")}}function se(a,i){if(a&1){let e=C();o(0,"nav",31)(1,"ul",37)(2,"li",38)(3,"button",39),c("click",function(){b(e);let l=s();return u(l.goToPage(l.pageIndex-1))}),r(4," Anterior "),n()(),S(5,me,3,3,"li",40,P),o(7,"li",38)(8,"button",39),c("click",function(){b(e);let l=s();return u(l.goToPage(l.pageIndex+1))}),r(9," Pr\xF3xima "),n()()()()}if(a&2){let e=s();m(2),v("disabled",e.pageIndex===0),m(),M("disabled",e.pageIndex===0),m(2),E(e.pages),m(2),v("disabled",e.pageIndex>=e.totalPages-1),m(),M("disabled",e.pageIndex>=e.totalPages-1)}}var ee=class a{membersService=x(Z);dialog=x(J);toastService=x(G);form;user=this.getUserFromLocalStorage();userRoles=W;name="";members=[];totalMembers=0;pageIndex=0;pageSize=10;sortBy="name";sortDirection="asc";ngOnInit(){this.getMemberList()}getUserFromLocalStorage(){let i=localStorage.getItem(U.APP_USER_KEY);return i?JSON.parse(i):null}openNewMember(){this.dialog.open(I,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(e=>{e&&this.getMemberList()})}searchByName(){this.membersService.getByName(this.name).pipe(h()).subscribe({next:i=>this.processMembersResponse(i,1,this.pageSize),error:i=>{this.toastService.error(i.error.error||"Erro desconhecido","Erro ao buscar lista de membros")}})}getMemberList(i=this.pageIndex,e=this.pageSize){let t=i+1;this.membersService.getPaginatedMembers(t,e,this.sortBy,this.sortDirection).pipe(h()).subscribe({next:l=>this.processMembersResponse(l,t,e),error:l=>{this.toastService.error(l.error.error||"Erro desconhecido","Erro ao buscar lista de membros")}})}processMembersResponse(i,e,t){if(!i){this.members=[],this.totalMembers=0;return}this.members=i.data??[],this.totalMembers=i.total??0,this.pageIndex=(i.page??e)-1,this.pageSize=i.limit??t}get totalPages(){return this.pageSize>0?Math.ceil(this.totalMembers/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(i,e)=>e)}goToPage(i){i<0||i>=this.totalPages||i===this.pageIndex||(this.pageIndex=i,this.getMemberList(this.pageIndex,this.pageSize))}changeSort(i){this.sortBy===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=i,this.sortDirection="asc"),this.pageIndex=0,this.getMemberList(0,this.pageSize)}editMember(i){this.membersService.getById(i).pipe(h()).subscribe({next:e=>{this.dialog.open(I,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:e}).afterClosed().subscribe(l=>{l&&this.getMemberList()})},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao buscar dados do membro")}})}deleteMember(i){this.dialog.open(X,{width:"400px",data:{title:"Excluir Membro",subtitle:"Tem certeza que deseja excluir este membro?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(t=>{t&&this.onDeleteMember(i)})}onDeleteMember(i){this.membersService.deleteMember(i).pipe(h()).subscribe({next:()=>{this.toastService.success("Membro exclu\xEDdo com sucesso."),this.getMemberList()},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao excluir o membro")}})}limpar(){this.name="",this.getMemberList(0,this.pageSize)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=T({type:a,selectors:[["app-members"]],decls:59,vars:7,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3","d-flex","align-items-center"],["fontIcon","filter_alt",1,"me-2"],[1,"row","mb-2"],[1,"col-12","col-lg-5","mb-3"],["for","name",1,"form-label"],["placeholder","Digite um nome ou parte de um nome para filtrar",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-lg-7","text-end"],["type","button",1,"btn","cancel-button",3,"click"],["fontIcon","clear",1,"submit-icon"],["type","submit",1,"btn","btn-primary","submit-button",3,"click","disabled"],["fontIcon","search",1,"submit-icon"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["colspan","6",1,"text-center","text-muted","small","py-4"],["aria-label","Editar Membro",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Membro",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Membros"),n(),o(5,"p",4),r(6,"Visualize e gerencie os membros cadastrados"),n()(),o(7,"div",5)(8,"button",6),c("click",function(){return t.openNewMember()}),p(9,"mat-icon",7),r(10," Novo Membro "),n()()(),o(11,"div",8)(12,"mat-card",9)(13,"h2",10),p(14,"mat-icon",11),r(15," Filtros "),n(),o(16,"div",12)(17,"div",13)(18,"label",14),r(19,"Nome"),n(),o(20,"input",15),N("ngModelChange",function(d){return D(t.name,d)||(t.name=d),d}),n()(),o(21,"div",16)(22,"button",17),c("click",function(){return t.limpar()}),p(23,"mat-icon",18),r(24," Limpar "),n(),o(25,"button",19),c("click",function(){return t.searchByName()}),p(26,"mat-icon",20),r(27," Pesquisar "),n()()()()(),o(28,"div",8)(29,"mat-card",9)(30,"h2",21),r(31,"Membros"),n(),o(32,"div",22)(33,"table",23)(34,"thead",24)(35,"tr")(36,"th",25),c("click",function(){return t.changeSort("name")}),r(37," Nome "),g(38,ie,1,2,"mat-icon",26),n(),o(39,"th"),r(40,"Tipo de Membro"),n(),o(41,"th"),r(42,"Telefone"),n(),o(43,"th"),r(44,"E-mail"),n(),o(45,"th"),r(46,"Data de Nascimento"),n(),g(47,ne,2,0,"th",27),n()(),o(48,"tbody"),g(49,oe,3,0,"tr")(50,le,2,0),n()()(),o(51,"div",28)(52,"div",29)(53,"p",30)(54,"strong"),r(55,"Total de membros:"),n(),r(56),n()(),o(57,"div",29),g(58,se,10,6,"nav",31),n()()()()()),e&2&&(m(20),R("ngModel",t.name),m(5),M("disabled",!t.name),m(13),_(t.sortBy==="name"?38:-1),m(9),_((t.user==null?null:t.user.role)===t.userRoles.ADMIN||(t.user==null?null:t.user.role)===t.userRoles.TREASURER||(t.user==null?null:t.user.role)===t.userRoles.SECRETARY?47:-1),m(2),_(t.members.length===0?49:50),m(7),y(" ",t.totalMembers),m(2),_(t.totalPages>1?58:-1))},dependencies:[Q,H,Y,$,j,K,q,A,O,V,L,z,B],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};export{ee as MembersComponent};
