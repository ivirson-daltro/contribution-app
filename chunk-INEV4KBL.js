import{a as ue}from"./chunk-GTUJ7HP6.js";import{a as re,b as D}from"./chunk-YWLCHPBO.js";import{a as ae,b as me,c as se,d as le,e as ce,f as de,g as A}from"./chunk-VIBL3TNU.js";import{a as q}from"./chunk-2J3QXTNU.js";import{b as Y,c as F,d as H,e as W,g as J,h as K,i as Q,j as X,k as Z,l as ee,m as te,n as ne,o as ie}from"./chunk-765CTO47.js";import"./chunk-5OMQI3NQ.js";import{a as pe,b as be}from"./chunk-P2OKJE6B.js";import{a as k,b as R}from"./chunk-PTM3XZIB.js";import{E as oe}from"./chunk-SY6A7M44.js";import{D as f,Ea as I,O as N,Pa as C,Pb as j,Qa as h,Ra as V,Sa as $,T as p,Ta as P,Ua as O,Va as u,Wa as r,Wb as L,X as _,Xa as o,Xb as G,Y as M,Ya as g,ab as T,bc as b,cb as c,db as l,lb as E,nb as m,ob as w,pb as v,ua as s,ub as z,yb as B,za as y,zb as U}from"./chunk-WWQWIYYY.js";import"./chunk-2NFLSA4Y.js";var x=class i{httpClient=p(G);getMemberTypes(){return this.httpClient.get(`${b.apiUrl}/domain/member-types`)}getPaginatedMembers(t=1,e=10,n,a="asc"){let d=new L().set("page",t.toString()).set("limit",e.toString());return n&&(d=d.set("sortBy",n).set("sortDirection",a)),this.httpClient.get(`${b.apiUrl}/members/paginated`,{params:d})}saveMember(t){return this.httpClient.post(`${b.apiUrl}/members`,t)}getById(t){return this.httpClient.get(`${b.apiUrl}/members/${t}`)}updateMember(t,e){return this.httpClient.put(`${b.apiUrl}/members/${t}`,e)}deleteMember(t){return this.httpClient.delete(`${b.apiUrl}/members/${t}`)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};function Ce(i,t){if(i&1&&(r(0,"option",10),m(1),o()),i&2){let e=t.$implicit;u("value",e.id),s(),w(e.description)}}var S=class i{constructor(t,e,n){this.fb=t;this.dialogRef=e;this.data=n}membersService=p(x);toastService=p(D);form;memberTypes$=this.membersService.getMemberTypes();ngOnInit(){this.buildForm(),this.data&&this.form.patchValue({name:this.data.name??"",memberTypeId:this.data.memberTypeId??""})}buildForm(){this.form=this.fb.group({name:["",F.required],memberTypeId:["",F.required]})}submit(){let t=this.form.getRawValue();this.data&&this.data.id?this.updateMember(this.data.id,t):this.saveMember(t)}saveMember(t){this.membersService.saveMember(t).pipe(f()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Membro cadastrado com sucesso.")},error:e=>{this.toastService.error(e?.error?.error??"Erro ao cadastrar membro.")}})}updateMember(t,e){this.membersService.updateMember(t,e).pipe(f()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Membro atualizado com sucesso.")},error:n=>{this.toastService.error(n?.error?.error??"Erro ao atualizar membro.")}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||i)(y(te),y(ae),y(me))};static \u0275cmp=I({type:i,selectors:[["app-add-members"]],decls:25,vars:6,consts:[[1,"cadastrar-container"],[1,"cadastrar-card"],["mat-dialog-title","",1,"card-title"],[1,"contribution-form",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["formControlName","name","placeholder","Digite o nome",1,"form-control"],["for","memberTypeId",1,"form-label"],["formControlName","memberTypeId",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],["align","end",1,"form-footer"],["type","button",1,"btn","cancel-button",3,"click"],["type","submit",1,"btn","btn-primary","submit-button",3,"disabled"],["fontIcon","save",1,"submit-icon"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),m(3),o(),r(4,"form",3),c("ngSubmit",function(){return n.submit()}),r(5,"mat-dialog-content")(6,"div",4)(7,"label",5),m(8,"Nome"),o(),g(9,"input",6),o(),r(10,"div",4)(11,"label",7),m(12,"Tipo de Membro"),o(),r(13,"select",8)(14,"option",9),m(15,"- Selecione"),o(),P(16,Ce,2,2,"option",10,V),B(18,"async"),o()()(),r(19,"mat-dialog-actions",11)(20,"button",12),c("click",function(){return n.close()}),m(21,"Cancelar"),o(),r(22,"button",13),g(23,"mat-icon",14),m(24),o()()()()()),e&2&&(s(3),v("",n.data?"Atualizar":"Novo"," Membro"),s(),u("formGroup",n.form),s(12),O(U(18,4,n.memberTypes$)),s(6),u("disabled",n.form.invalid),s(2),v(" ",n.data?"Atualizar":"Cadastrar"," Membro "))},dependencies:[ie,J,Z,ee,Y,X,H,W,Q,K,A,le,de,ce,R,k,j],styles:[".cadastrar-container[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:700;color:#0b2454}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-body[_ngcontent-%COMP%]{padding-top:.25rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:600;margin-bottom:.35rem;color:#374151}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#f7f9fc;border-radius:.75rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#d1d5db}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#1d4ed8}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #e5e7eb;display:flex;gap:1rem;align-items:center}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:3rem;border-radius:.625rem;background-color:#0b2454;font-weight:600}@media(max-width:600px){.cadastrar-card[_ngcontent-%COMP%]{padding:1.25rem 1.25rem 1.75rem}}"]})};var he=(i,t)=>t.id;function ve(i,t){if(i&1&&g(0,"mat-icon",15),i&2){let e=l();u("fontIcon",z(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function xe(i,t){i&1&&(r(0,"th",16),m(1,"A\xE7\xF5es"),o())}function Pe(i,t){i&1&&(r(0,"tr")(1,"td",21),m(2," Nenhum membro encontrado. "),o()())}function Oe(i,t){if(i&1){let e=T();r(0,"td",16)(1,"button",22),c("click",function(){_(e);let a=l().$implicit,d=l(2);return M(d.editMember(a.id))}),g(2,"mat-icon",23),o(),r(3,"button",24),c("click",function(){_(e);let a=l().$implicit,d=l(2);return M(d.deleteMember(a.id))}),g(4,"mat-icon",25),o()()}}function Se(i,t){if(i&1&&(r(0,"tr")(1,"td"),m(2),o(),C(3,Oe,5,0,"td",16),o()),i&2){let e=t.$implicit,n=l(2);s(2),w(e.name),s(),h((n.user==null?null:n.user.role)===n.userRoles.ADMIN||(n.user==null?null:n.user.role)===n.userRoles.TREASURER||(n.user==null?null:n.user.role)===n.userRoles.SECRETARY?3:-1)}}function ye(i,t){if(i&1&&P(0,Se,4,2,"tr",null,he),i&2){let e=l();O(e.members)}}function Ie(i,t){if(i&1){let e=T();r(0,"li",27)(1,"button",30),c("click",function(){let a=_(e).$implicit,d=l(2);return M(d.goToPage(a))}),m(2),o()()}if(i&2){let e=t.$implicit,n=l(2);E("active",n.pageIndex===e),s(2),v(" ",e+1," ")}}function Te(i,t){if(i&1){let e=T();r(0,"nav",20)(1,"ul",26)(2,"li",27)(3,"button",28),c("click",function(){_(e);let a=l();return M(a.goToPage(a.pageIndex-1))}),m(4," Anterior "),o()(),P(5,Ie,3,3,"li",29,$),r(7,"li",27)(8,"button",28),c("click",function(){_(e);let a=l();return M(a.goToPage(a.pageIndex+1))}),m(9," Pr\xF3xima "),o()()()()}if(i&2){let e=l();s(2),E("disabled",e.pageIndex===0),s(),u("disabled",e.pageIndex===0),s(2),O(e.pages),s(2),E("disabled",e.pageIndex>=e.totalPages-1),s(),u("disabled",e.pageIndex>=e.totalPages-1)}}var fe=class i{membersService=p(x);dialog=p(se);toastService=p(D);form;user=this.getUserFromLocalStorage();userRoles=q;members=[];totalMembers=0;pageIndex=0;pageSize=10;sortBy="name";sortDirection="asc";ngOnInit(){this.getMemberList()}getUserFromLocalStorage(){let t=localStorage.getItem(b.APP_USER_KEY);return t?JSON.parse(t):null}openNewMember(){this.dialog.open(S,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(e=>{e&&this.getMemberList()})}getMemberList(t=this.pageIndex,e=this.pageSize){let n=t+1;this.membersService.getPaginatedMembers(n,e,this.sortBy,this.sortDirection).pipe(f()).subscribe(a=>{if(!a){this.members=[],this.totalMembers=0;return}this.members=a.data??[],this.totalMembers=a.total??0,this.pageIndex=(a.page??n)-1,this.pageSize=a.limit??e})}get totalPages(){return this.pageSize>0?Math.ceil(this.totalMembers/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(t,e)=>e)}goToPage(t){t<0||t>=this.totalPages||t===this.pageIndex||(this.pageIndex=t,this.getMemberList(this.pageIndex,this.pageSize))}changeSort(t){this.sortBy===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=t,this.sortDirection="asc"),this.pageIndex=0,this.getMemberList(0,this.pageSize)}editMember(t){this.membersService.getById(t).pipe(f()).subscribe({next:e=>{this.dialog.open(S,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:e}).afterClosed().subscribe(a=>{a&&this.getMemberList()})},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao buscar dados do membro")}})}deleteMember(t){this.dialog.open(ue,{width:"400px",data:{title:"Excluir Membro",subtitle:"Tem certeza que deseja excluir este membro?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(n=>{n&&this.onDeleteMember(t)})}onDeleteMember(t){this.membersService.deleteMember(t).pipe(f()).subscribe({next:()=>{this.toastService.success("Membro exclu\xEDdo com sucesso."),this.getMemberList()},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao excluir o membro")}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-members"]],decls:34,vars:5,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["colspan","6",1,"text-center","text-muted","small","py-4"],["aria-label","Editar Membro",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Membro",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),m(4,"Membros"),o(),r(5,"p",4),m(6,"Visualize e gerencie os membros cadastrados"),o()(),r(7,"div",5)(8,"button",6),c("click",function(){return n.openNewMember()}),g(9,"mat-icon",7),m(10," Novo Membro "),o()()(),r(11,"div",8)(12,"mat-card",9)(13,"h2",10),m(14,"Membros"),o(),r(15,"div",11)(16,"table",12)(17,"thead",13)(18,"tr")(19,"th",14),c("click",function(){return n.changeSort("name")}),m(20," Nome "),C(21,ve,1,2,"mat-icon",15),o(),C(22,xe,2,0,"th",16),o()(),r(23,"tbody"),C(24,Pe,3,0,"tr")(25,ye,2,0),o()()(),r(26,"div",17)(27,"div",18)(28,"p",19)(29,"strong"),m(30,"Total de membros:"),o(),m(31),o()(),r(32,"div",18),C(33,Te,10,6,"nav",20),o()()()()()),e&2&&(s(21),h(n.sortBy==="name"?21:-1),s(),h((n.user==null?null:n.user.role)===n.userRoles.ADMIN||(n.user==null?null:n.user.role)===n.userRoles.TREASURER||(n.user==null?null:n.user.role)===n.userRoles.SECRETARY?22:-1),s(2),h(n.members.length===0?24:25),s(7),v(" ",n.totalMembers),s(2),h(n.totalPages>1?33:-1))},dependencies:[be,pe,oe,R,k,A,re,ne],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};export{fe as MembersComponent};
