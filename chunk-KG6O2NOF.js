import{a as dt}from"./chunk-FLXGVO2J.js";import{a as Jt}from"./chunk-ALGXMCKG.js";import{a as Lt,b as Ut,c as jt,d as zt,e as Gt,f as qt,g as Ht}from"./chunk-25RZTJKE.js";import{a as st}from"./chunk-UBGDYJEC.js";import{a as Kt}from"./chunk-DSWH4VZR.js";import{b as Vt}from"./chunk-723QPIKE.js";import{a as Nt,b as ot}from"./chunk-VZNXFT7U.js";import"./chunk-TAR3LFPR.js";import{a as rt,b as $t,c as at,d as lt,e as mt,f as ct,g as L}from"./chunk-P74SJGKF.js";import{a as At}from"./chunk-2J3QXTNU.js";import{c as N,e as P,g as $,h as J,j as kt,k as Dt,l as K,m as Rt,n as Y,o as Q,p as X,q as Z,r as tt,s as et,t as Ft,u as nt}from"./chunk-GFUDPGUP.js";import{a as Bt,b as Wt}from"./chunk-PNOVXD2Q.js";import{a as B,b as W}from"./chunk-7WCVQ4OW.js";import{L as it}from"./chunk-QK5Q5MQS.js";import{$ as g,$a as x,Ab as I,Bb as R,Cb as F,Da as G,Db as V,E as C,Fb as A,Ia as D,Ib as xt,Jb as w,K as ht,Kb as k,L as vt,Mb as wt,Nb as Pt,R as yt,W as b,Wa as _,Xa as h,Ya as O,Za as Mt,_ as f,_a as S,ab as s,bb as o,c as Ct,cb as i,db as p,gc as H,hb as T,hc as Et,ic as Tt,jb as d,jc as Ot,kb as u,m as _t,nc as ut,oc as It,ub as St,uc as y,wb as q,ya as m,yb as l,zb as v}from"./chunk-3U63YFDR.js";import{a as ft,b as gt}from"./chunk-7CGTOI24.js";var U=class r{httpClient=b(It);getContributionTypes(){return this.httpClient.get(`${y.apiUrl}/domain/contribution-types`)}getPaymentMethods(){return this.httpClient.get(`${y.apiUrl}/domain/payment-methods`)}getContributions(n,t,e,a=1,c=10,M,j="desc"){let E=new ut().set("page",a.toString()).set("limit",c.toString());return M&&(E=E.set("sortBy",M).set("sortDirection",j)),n&&(E=E.set("memberId",n)),t&&(E=E.set("contributionTypeId",t)),e&&(E=E.set("paymentMethodId",e)),this.httpClient.get(`${y.apiUrl}/contributions/paginated`,{params:E})}saveContribution(n){return this.httpClient.post(`${y.apiUrl}/contributions`,n)}getContributionById(n){return this.httpClient.get(`${y.apiUrl}/contributions/${n}`)}updateContribution(n,t){return this.httpClient.put(`${y.apiUrl}/contributions/${n}`,t)}deleteContribution(n){return this.httpClient.delete(`${y.apiUrl}/contributions/${n}`)}getWeeklyReport(n,t){let e=new ut().set("startDate",n).set("endDate",t);return this.httpClient.get(`${y.apiUrl}/contributions/weekly/report`,{params:e,responseType:"blob"})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=yt({token:r,factory:r.\u0275fac,providedIn:"root"})};function ee(r,n){if(r&1&&(o(0,"mat-option",11),l(1),i()),r&2){let t=n.$implicit;s("value",t),m(),I(" ",t.name," ")}}function ne(r,n){if(r&1&&(o(0,"option",11),l(1),i()),r&2){let t=n.$implicit;s("value",t.id),m(),v(t.description)}}function ie(r,n){if(r&1&&(o(0,"option",11),l(1),i()),r&2){let t=n.$implicit;s("value",t.id),m(),v(t.type)}}var z=class r{constructor(n,t,e){this.fb=n;this.dialogRef=t;this.data=e}selectedFile=null;contributionsService=b(U);membersService=b(st);toastService=b(ot);dialog=b(at);utilsService=b(dt);form;members$=this.membersService.getMembers();filteredMembers$=new Ct;contributionTypes$=this.contributionsService.getContributionTypes();paymentMethods$=this.contributionsService.getPaymentMethods();contributionTypesCache=[];today=new Date;maxDate=this.today.toISOString().substring(0,10);memberSearchControl=new kt("",{nonNullable:!0});ngOnInit(){this.buildForm(),this.loadContributionTypes(),this.setupMemberValidation(),this.filteredMembers$=this.memberSearchControl.valueChanges.pipe(ht(""),vt(n=>this.members$.pipe(_t(t=>{let e=typeof n=="string"?n.toLowerCase():"";return e?t.filter(a=>a.name.toLowerCase().includes(e)):t})))),this.form.get("amount")?.valueChanges.subscribe(n=>{if(n!=null&&n!==""){let t=this.formatAmountString(n);t!==n&&this.form.get("amount")?.setValue(t,{emitEvent:!1})}}),this.data&&Promise.all([this.members$.pipe(C()).toPromise(),this.contributionTypes$.pipe(C()).toPromise(),this.paymentMethods$.pipe(C()).toPromise()]).then(()=>{this.form.patchValue({memberId:this.data?.memberId??"",contributionTypeId:this.data?.contributionTypeId??"",paymentMethodId:this.data?.paymentMethodId??"",amount:this.data?.amount??"",date:this.data?.date?this.data.date.substring(0,10):"",observation:this.data?.observation??""}),this.data?.memberId&&this.members$.pipe(C()).subscribe(n=>{let t=n.find(e=>e.id===this.data?.memberId);t&&this.memberSearchControl.setValue(t.name,{emitEvent:!1})})})}onMemberSelected(n){this.form.get("memberId")?.setValue(n.id),this.memberSearchControl.setValue(n.name,{emitEvent:!1})}formatAmountString(n){if(!n)return"";let t=n.replace(/R\$/g,"").replace(/\s/g,"");if(t.includes(",")){let[e,a]=t.split(",");return a&&a.length===2?`R$ ${e.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${a}`:a&&a.length===1?`R$ ${e.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${a}0`:`R$ ${e.replace(/\B(?=(\d{3})+(?!\d))/g,".")},00`}return`R$ ${t.replace(/\B(?=(\d{3})+(?!\d))/g,".")},00`}buildForm(){this.form=this.fb.group({memberId:["",P.required],contributionTypeId:["",P.required],paymentMethodId:["",P.required],amount:["",[P.required]],date:[this.today.toISOString().substring(0,10),P.required],observation:[""]})}submit(){let n=this.form.getRawValue(),t=gt(ft({},n),{amount:typeof n.amount=="string"?parseFloat(n.amount.replace(",",".")):n.amount}),e=new FormData;e.append("contribution",JSON.stringify(t)),this.selectedFile&&e.append("file",this.selectedFile),this.data&&this.data.id?this.updateContribution(e):this.saveContribution(e)}onFileSelected(n){let t=n.target;t.files&&t.files.length>0?this.selectedFile=t.files[0]:this.selectedFile=null}saveContribution(n){this.contributionsService.saveContribution(n).pipe(C()).subscribe({next:()=>{this.dialogRef.close(!0)},error:t=>{this.toastService.error("Erro ao salvar contribui\xE7\xE3o. Por favor, tente novamente.")}})}updateContribution(n){this.contributionsService.updateContribution(this.data.id,n).pipe(C()).subscribe({next:()=>{this.dialogRef.close(!0)},error:t=>{this.toastService.error("Erro ao atualizar contribui\xE7\xE3o. Por favor, tente novamente.")}})}loadContributionTypes(){this.contributionTypes$.pipe(C()).subscribe(n=>{this.contributionTypesCache=n??[]})}setupMemberValidation(){let n=this.form.get("memberId"),t=this.form.get("contributionTypeId");!n||!t||t.valueChanges.subscribe(e=>{this.isOfertaType(e)?n.clearValidators():n.setValidators([P.required]),n.updateValueAndValidity()})}isOfertaType(n){if(!n)return!1;let t=this.contributionTypesCache.find(e=>e.id===n);return!!t&&t.description?.toLowerCase()==="oferta"}openNewMember(){this.dialog.open(Jt,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(t=>{t&&(this.members$=this.membersService.getMembers().pipe(C()))})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||r)(G(et),G(rt),G($t))};static \u0275cmp=D({type:r,selectors:[["app-add-contributions"]],decls:67,vars:14,consts:[["autoMember","matAutocomplete"],[1,"cadastrar-container"],[1,"cadastrar-card"],["mat-dialog-title","",1,"card-title"],[1,"contribution-form",3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"row"],[1,"col-md-8"],["for","memberId",1,"form-label"],["type","text","matInput","","placeholder","Buscar membro",1,"form-control",3,"formControl","matAutocomplete"],[3,"optionSelected"],[3,"value"],[1,"col-md-4","d-flex","justify-content-end"],["type","button",1,"btn","btn-primary","submit-button","mt-4",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-lg-6"],["for","contributionTypeId",1,"form-label"],["formControlName","contributionTypeId",1,"form-control"],["value","","disabled","","selected",""],["for","paymentMethodId",1,"form-label"],["formControlName","paymentMethodId",1,"form-control"],["for","amount",1,"form-label"],["type","text","formControlName","amount","placeholder","R$ 0,00","mask","separator.2","thousandSeparator",".","decimalMarker",",","prefix","R$ ","inputMode","decimal","autocomplete","off",1,"form-control",3,"blur","dropSpecialCharacters"],["for","date",1,"form-label"],["type","date","formControlName","date","placeholder","Digite a data",1,"form-control",3,"max"],[1,"col-lg-12"],["for","attachment",1,"form-label"],["type","file","id","attachment","accept",".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx",1,"form-control",3,"change"],["for","observation",1,"form-label"],["formControlName","observation",1,"form-control"],["align","end",1,"form-footer"],["type","button",1,"btn","cancel-button",3,"click"],["type","submit",1,"btn","btn-primary","submit-button",3,"disabled"],["fontIcon","save",1,"submit-icon"]],template:function(t,e){if(t&1){let a=T();o(0,"div",1)(1,"div",2)(2,"h2",3),l(3),i(),o(4,"form",4),d("ngSubmit",function(){return f(a),g(e.submit())}),o(5,"mat-dialog-content")(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),l(10,"Membro"),i(),p(11,"input",9),o(12,"mat-autocomplete",10,0),d("optionSelected",function(M){return f(a),g(e.onMemberSelected(M.option.value))}),S(14,ee,2,2,"mat-option",11,O),w(16,"async"),i()(),o(17,"div",12)(18,"button",13),d("click",function(){return f(a),g(e.openNewMember())}),p(19,"mat-icon",14),l(20," Novo Membro "),i()()()(),o(21,"div",5)(22,"div",6)(23,"div",15)(24,"label",16),l(25,"Tipo de Contribui\xE7\xE3o"),i(),o(26,"select",17)(27,"option",18),l(28,"- Selecione"),i(),S(29,ne,2,2,"option",11,O),w(31,"async"),i()(),o(32,"div",15)(33,"label",19),l(34,"Forma de Pagamento"),i(),o(35,"select",20)(36,"option",18),l(37,"- Selecione"),i(),S(38,ie,2,2,"option",11,O),w(40,"async"),i()()()(),o(41,"div",5)(42,"div",6)(43,"div",15)(44,"label",21),l(45,"Valor"),i(),o(46,"input",22),d("blur",function(){return f(a),g(e.utilsService.onAmountBlur(e.form,"amount"))}),i()(),o(47,"div",15)(48,"label",23),l(49,"Data"),i(),p(50,"input",24),i()()(),o(51,"div",5)(52,"div",6)(53,"div",25)(54,"label",26),l(55,"Anexar comprovante"),i(),o(56,"input",27),d("change",function(M){return f(a),g(e.onFileSelected(M))}),i()()()(),o(57,"div",5)(58,"label",28),l(59,"Observa\xE7\xF5es"),i(),p(60,"textarea",29),i()(),o(61,"mat-dialog-actions",30)(62,"button",31),d("click",function(){return f(a),g(e.close())}),l(63,"Cancelar"),i(),o(64,"button",32),p(65,"mat-icon",33),l(66),i()()()()()}if(t&2){let a=St(13);m(3),I("",e.data?"Editar":"Nova"," Contribui\xE7\xE3o"),m(),s("formGroup",e.form),m(7),s("formControl",e.memberSearchControl)("matAutocomplete",a),m(3),x(k(16,8,e.filteredMembers$)),m(15),x(k(31,10,e.contributionTypes$)),m(9),x(k(40,12,e.paymentMethods$)),m(8),s("dropSpecialCharacters",!0),m(4),s("max",e.maxDate),m(14),s("disabled",e.form.invalid),m(2),I(" ",e.data?"Editar":"Registrar"," Contribui\xE7\xE3o ")}},dependencies:[nt,K,Z,tt,N,X,$,J,Rt,Q,Y,L,lt,ct,mt,W,B,qt,Gt,zt,Ut,Lt,jt,Ht,Vt,H],styles:[".cadastrar-container[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:700;color:#0b2454}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-body[_ngcontent-%COMP%]{padding-top:.25rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:600;margin-bottom:.35rem;color:#374151}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#f7f9fc;border-radius:.75rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#d1d5db}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#1d4ed8}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #e5e7eb;display:flex;gap:1rem;align-items:center}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:3rem;border-radius:.625rem;background-color:#0b2454;font-weight:600}.cadastrar-container[_ngcontent-%COMP%]   .autocomplete-wrapper[_ngcontent-%COMP%]{position:relative;width:100%}.cadastrar-container[_ngcontent-%COMP%]   .autocomplete-list[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;z-index:10;background:#fff;border:1px solid #ddd;border-radius:0 0 4px 4px;max-height:200px;overflow-y:auto;margin:0;padding:0;list-style:none}.cadastrar-container[_ngcontent-%COMP%]   .autocomplete-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer;transition:background .2s}.cadastrar-container[_ngcontent-%COMP%]   .autocomplete-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#f5f5f5}.cadastrar-container[_ngcontent-%COMP%]   .autocomplete-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{background:#e3e3e3;font-weight:700}[_nghost-%COMP%]     .cdk-overlay-pane .mat-mdc-autocomplete-panel{background-color:#fff!important}[_nghost-%COMP%]     .mat-mdc-option{background-color:#fff}[_nghost-%COMP%]     .mat-mdc-option.mdc-list-item--activated, [_nghost-%COMP%]     .mat-mdc-option.mdc-list-item--selected{background-color:#f5f5f5}@media(max-width:600px){.cadastrar-card[_ngcontent-%COMP%]{padding:1.25rem 1.25rem 1.75rem}}"]})};var pt=class r{dialogRef=b(rt);fb=b(et);form=this.fb.group({startDate:["",P.required],endDate:["",P.required]});close(){this.dialogRef.close()}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.dialogRef.close(this.form.value)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=D({type:r,selectors:[["app-weekly-report-dialog"]],decls:18,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"weekly-report-form",3,"formGroup"],[1,"mb-3"],["for","startDate",1,"form-label"],["id","startDate","type","date","formControlName","startDate",1,"form-control"],["for","endDate",1,"form-label"],["id","endDate","type","date","formControlName","endDate",1,"form-control"],["mat-dialog-actions","",1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-primary","submit-button",3,"click","disabled"],["fontIcon","download",1,"submit-icon"],["type","button",1,"btn","cancel-button",3,"click"]],template:function(t,e){t&1&&(o(0,"h2",0),l(1,"Relat\xF3rio semanal"),i(),o(2,"div",1)(3,"form",2)(4,"div",3)(5,"label",4),l(6,"Data inicial"),i(),p(7,"input",5),i(),o(8,"div",3)(9,"label",6),l(10,"Data final"),i(),p(11,"input",7),i()()(),o(12,"div",8)(13,"button",9),d("click",function(){return e.submit()}),p(14,"mat-icon",10),l(15," Gerar PDF "),i(),o(16,"button",11),d("click",function(){return e.close()}),l(17,"Cancelar"),i()()),t&2&&(m(3),s("formGroup",e.form),m(10),s("disabled",e.form.invalid))},dependencies:[Ot,nt,K,N,$,J,Q,Y,L,lt,ct,mt,it,W,B],styles:[".weekly-report-form[_ngcontent-%COMP%]{min-width:260px}.weekly-report-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};var oe=r=>[r,"BRL","symbol","1.2-2","pt-BR"],re=(r,n)=>n.id;function ae(r,n){if(r&1){let t=T();o(0,"button",41),d("click",function(){f(t);let a=u();return g(a.openNewContribution())}),p(1,"mat-icon",42),l(2," Nova contribui\xE7\xE3o "),i()}}function le(r,n){if(r&1&&(o(0,"option",16),l(1),i()),r&2){let t=n.$implicit;s("value",t.id),m(),v(t.name)}}function me(r,n){if(r&1&&(o(0,"option",16),l(1),i()),r&2){let t=n.$implicit;s("value",t.id),m(),v(t.description)}}function ce(r,n){if(r&1&&(o(0,"option",16),l(1),i()),r&2){let t=n.$implicit;s("value",t.id),m(),v(t.type)}}function se(r,n){if(r&1){let t=T();o(0,"button",43),d("click",function(){f(t);let a=u();return g(a.getWeeklyReport())}),p(1,"mat-icon",44),l(2," Imprimir Relat\xF3rio da semana "),i()}}function de(r,n){if(r&1&&p(0,"mat-icon",35),r&2){let t=u();s("fontIcon",A(t.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function pe(r,n){if(r&1&&p(0,"mat-icon",35),r&2){let t=u();s("fontIcon",A(t.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function ue(r,n){if(r&1&&p(0,"mat-icon",35),r&2){let t=u();s("fontIcon",A(t.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function be(r,n){if(r&1&&p(0,"mat-icon",35),r&2){let t=u();s("fontIcon",A(t.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function fe(r,n){if(r&1&&p(0,"mat-icon",35),r&2){let t=u();s("fontIcon",A(t.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function ge(r,n){r&1&&(o(0,"th",36),l(1,"A\xE7\xF5es"),i())}function Ce(r,n){r&1&&(o(0,"tr")(1,"td",45),l(2," Nenhuma contribui\xE7\xE3o encontrada. "),i()())}function _e(r,n){if(r&1){let t=T();o(0,"a",49),d("click",function(a){f(t);let c=u().$implicit;return u(2).downloadAttachment(c.attachmentUrl),g(a.preventDefault())}),p(1,"mat-icon",50),i()}}function he(r,n){r&1&&(o(0,"span",48),l(1,"-"),i())}function ve(r,n){if(r&1){let t=T();o(0,"td",36)(1,"button",51),d("click",function(){f(t);let a=u().$implicit,c=u(2);return g(c.editContribution(a.id))}),p(2,"mat-icon",52),i(),o(3,"button",53),d("click",function(){f(t);let a=u().$implicit,c=u(2);return g(c.deleteContribution(a.id))}),p(4,"mat-icon",54),i()()}}function ye(r,n){if(r&1&&(o(0,"tr")(1,"td"),l(2),w(3,"date"),i(),o(4,"td"),l(5),i(),o(6,"td"),l(7),i(),o(8,"td"),l(9),i(),o(10,"td"),l(11),w(12,"currency"),i(),o(13,"td",46),_(14,_e,2,0,"a",47)(15,he,2,0,"span",48),i(),_(16,ve,5,0,"td",36),i()),r&2){let t=n.$implicit,e=u(2);m(2),v(wt(3,7,t.date,"shortDate","pt-BR")),m(3),v((t.member==null?null:t.member.name)??"-"),m(2),v(t.contributionType.description),m(2),v(t.paymentMethod.type),m(2),I(" ",Pt(12,11,xt(17,oe,e.utilsService.normalizeAmount(t.amount)))," "),m(3),h(t.attachmentUrl?14:15),m(2),h((e.user==null?null:e.user.role)===e.userRoles.ADMIN||(e.user==null?null:e.user.role)===e.userRoles.TREASURER?16:-1)}}function Me(r,n){if(r&1&&S(0,ye,17,19,"tr",null,re),r&2){let t=u();x(t.contributions)}}function Se(r,n){if(r&1){let t=T();o(0,"li",56)(1,"button",59),d("click",function(){let a=f(t).$implicit,c=u(2);return g(c.goToPage(a))}),l(2),i()()}if(r&2){let t=n.$implicit,e=u(2);q("active",e.pageIndex===t),m(2),I(" ",t+1," ")}}function xe(r,n){if(r&1){let t=T();o(0,"nav",40)(1,"ul",55)(2,"li",56)(3,"button",57),d("click",function(){f(t);let a=u();return g(a.goToPage(a.pageIndex-1))}),l(4," Anterior "),i()(),S(5,Se,3,3,"li",58,Mt),o(7,"li",56)(8,"button",57),d("click",function(){f(t);let a=u();return g(a.goToPage(a.pageIndex+1))}),l(9," Pr\xF3xima "),i()()()()}if(r&2){let t=u();m(2),q("disabled",t.pageIndex===0),m(),s("disabled",t.pageIndex===0),m(2),x(t.pages),m(2),q("disabled",t.pageIndex>=t.totalPages-1),m(),s("disabled",t.pageIndex>=t.totalPages-1)}}var Zt=class r{contributionsService=b(U);membersService=b(st);dialog=b(at);toastService=b(ot);utilsService=b(dt);form;user=this.getUserFromLocalStorage();userRoles=At;members$=this.membersService.getMembers();contributionTypes$=this.contributionsService.getContributionTypes();paymentMethods$=this.contributionsService.getPaymentMethods();contributions=[];totalContributions=0;pageIndex=0;pageSize=10;sortBy="date";sortDirection="desc";memberId=null;contributionTypeId=null;paymentMethodId=null;startDate=null;endDate=null;ngOnInit(){this.getContributionList()}getUserFromLocalStorage(){let n=localStorage.getItem(y.APP_USER_KEY);return n?JSON.parse(n):null}openNewContribution(){this.dialog.open(z,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(t=>{t&&this.getContributionList()})}getContributionList(n=this.pageIndex,t=this.pageSize){let e=n+1;this.contributionsService.getContributions(this.memberId,this.contributionTypeId,this.paymentMethodId,e,t,this.sortBy,this.sortDirection).pipe(C()).subscribe(a=>{if(!a){this.contributions=[],this.totalContributions=0;return}this.contributions=a.data??[],this.totalContributions=a.total??0,this.pageIndex=(a.page??e)-1,this.pageSize=a.limit??t})}get totalPages(){return this.pageSize>0?Math.ceil(this.totalContributions/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(n,t)=>t)}goToPage(n){n<0||n>=this.totalPages||n===this.pageIndex||(this.pageIndex=n,this.getContributionList(this.pageIndex,this.pageSize))}changeSort(n){this.sortBy===n?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=n,this.sortDirection="asc"),this.pageIndex=0,this.getContributionList(0,this.pageSize)}limpar(){this.memberId=null,this.contributionTypeId=null,this.paymentMethodId=null,this.getContributionList(0,this.pageSize)}getWeeklyReport(){this.dialog.open(pt,{width:"400px",autoFocus:!1}).afterClosed().pipe(C()).subscribe(t=>{if(!t)return;let{startDate:e,endDate:a}=t;if(!e||!a){this.toastService.warning("Informe a data inicial e final para o relat\xF3rio.");return}this.contributionsService.getWeeklyReport(e,a).pipe(C()).subscribe({next:c=>{let M=window.URL.createObjectURL(c),j=document.createElement("a");j.href=M,j.download=`relatorio-semanal-${e}-a-${a}.pdf`,j.click(),window.URL.revokeObjectURL(M)},error:c=>{this.toastService.error(c.error.error||"Erro desconhecido","Erro ao gerar relat\xF3rio semanal")}})})}editContribution(n){this.contributionsService.getContributionById(n).pipe(C()).subscribe({next:t=>{this.dialog.open(z,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:t}).afterClosed().subscribe(a=>{a&&this.getContributionList()})},error:t=>{this.toastService.error(t.error.error||"Erro desconhecido","Erro ao buscar dados da contribui\xE7\xE3o")}})}deleteContribution(n){this.dialog.open(Kt,{width:"400px",data:{title:"Excluir Contribui\xE7\xE3o",subtitle:"Tem certeza que deseja excluir esta contribui\xE7\xE3o?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(e=>{e&&this.onDeleteContribution(n)})}onDeleteContribution(n){this.contributionsService.deleteContribution(n).pipe(C()).subscribe({next:()=>{this.toastService.success("Contribui\xE7\xE3o exclu\xEDda com sucesso."),this.getContributionList()},error:t=>{this.toastService.error(t.error.error||"Erro desconhecido","Erro ao excluir a contribui\xE7\xE3o")}})}async downloadAttachment(n){this.utilsService.downloadAttachment(n)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=D({type:r,selectors:[["app-contributions"]],decls:97,vars:25,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3","d-flex","align-items-center"],["fontIcon","filter_alt",1,"me-2"],[1,"row","mb-2"],[1,"col-12","col-lg","mb-3"],["for","memberId",1,"form-label"],[1,"form-control",3,"ngModelChange","ngModel"],["disabled","","selected","",3,"value"],[3,"value"],["for","contributionTypeId",1,"form-label"],["for","paymentMethodId",1,"form-label"],["for","startDate",1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["for","endDate",1,"form-label"],[1,"row","justify-content-between"],[1,"col-12","col-lg-4"],["type","button",1,"btn","btn-primary","submit-button","btn-print"],[1,"col-12","col-lg-4","text-end"],["type","button",1,"btn","cancel-button",3,"click"],["fontIcon","clear",1,"submit-icon"],["type","submit",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","search",1,"submit-icon"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],["type","button",1,"btn","btn-primary","submit-button","btn-print",3,"click"],["fontIcon","print",1,"submit-icon"],["colspan","6",1,"text-center","text-muted","small","py-4"],[1,"d-flex","justify-content-center"],["href","#",1,"attachment-link"],[1,"text-muted","py-2"],["href","#",1,"attachment-link",3,"click"],["fontIcon","attach_file"],["aria-label","Editar Contribui\xE7\xE3o",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Contribui\xE7\xE3o",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(t,e){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),l(4,"Contribui\xE7\xF5es"),i(),o(5,"p",4),l(6,"Visualize e gerencie todas as contribui\xE7\xF5es"),i()(),o(7,"div",5),_(8,ae,3,0,"button",6),i()(),o(9,"div",7)(10,"mat-card",8)(11,"h2",9),p(12,"mat-icon",10),l(13," Filtros "),i(),o(14,"div",11)(15,"div",12)(16,"label",13),l(17,"Membro"),i(),o(18,"select",14),V("ngModelChange",function(c){return F(e.memberId,c)||(e.memberId=c),c}),o(19,"option",15),l(20,"- Selecione"),i(),S(21,le,2,2,"option",16,O),w(23,"async"),i()(),o(24,"div",12)(25,"label",17),l(26,"Tipo"),i(),o(27,"select",14),V("ngModelChange",function(c){return F(e.contributionTypeId,c)||(e.contributionTypeId=c),c}),o(28,"option",15),l(29,"- Selecione"),i(),S(30,me,2,2,"option",16,O),w(32,"async"),i()(),o(33,"div",12)(34,"label",18),l(35,"Pagamento"),i(),o(36,"select",14),V("ngModelChange",function(c){return F(e.paymentMethodId,c)||(e.paymentMethodId=c),c}),o(37,"option",15),l(38,"- Selecione"),i(),S(39,ce,2,2,"option",16,O),w(41,"async"),i()(),o(42,"div",12)(43,"label",19),l(44,"Data inicial"),i(),o(45,"input",20),V("ngModelChange",function(c){return F(e.startDate,c)||(e.startDate=c),c}),i()(),o(46,"div",12)(47,"label",21),l(48,"Data Final"),i(),o(49,"input",20),V("ngModelChange",function(c){return F(e.endDate,c)||(e.endDate=c),c}),i()()(),o(50,"div",22)(51,"div",23),_(52,se,3,0,"button",24),i(),o(53,"div",25)(54,"button",26),d("click",function(){return e.limpar()}),p(55,"mat-icon",27),l(56," Limpar "),i(),o(57,"button",28),d("click",function(){return e.getContributionList()}),p(58,"mat-icon",29),l(59," Pesquisar "),i()()()()(),o(60,"div",7)(61,"mat-card",8)(62,"h2",30),l(63,"Contribui\xE7\xF5es"),i(),o(64,"div",31)(65,"table",32)(66,"thead",33)(67,"tr")(68,"th",34),d("click",function(){return e.changeSort("date")}),l(69," Data "),_(70,de,1,2,"mat-icon",35),i(),o(71,"th",34),d("click",function(){return e.changeSort("memberName")}),l(72," Membro "),_(73,pe,1,2,"mat-icon",35),i(),o(74,"th",34),d("click",function(){return e.changeSort("contributionTypeType")}),l(75," Tipo "),_(76,ue,1,2,"mat-icon",35),i(),o(77,"th",34),d("click",function(){return e.changeSort("paymentMethodDescription")}),l(78," Pagamento "),_(79,be,1,2,"mat-icon",35),i(),o(80,"th",34),d("click",function(){return e.changeSort("amount")}),l(81," Valor "),_(82,fe,1,2,"mat-icon",35),i(),o(83,"th",36),l(84,"Anexo"),i(),_(85,ge,2,0,"th",36),i()(),o(86,"tbody"),_(87,Ce,3,0,"tr")(88,Me,2,0),i()()(),o(89,"div",37)(90,"div",38)(91,"p",39)(92,"strong"),l(93,"Total de contribui\xE7\xF5es:"),i(),l(94),i()(),o(95,"div",38),_(96,xe,10,6,"nav",40),i()()()()()),t&2&&(m(8),h((e.user==null?null:e.user.role)===e.userRoles.ADMIN||(e.user==null?null:e.user.role)===e.userRoles.TREASURER?8:-1),m(10),R("ngModel",e.memberId),m(),s("value",null),m(2),x(k(23,19,e.members$)),m(6),R("ngModel",e.contributionTypeId),m(),s("value",null),m(2),x(k(32,21,e.contributionTypes$)),m(6),R("ngModel",e.paymentMethodId),m(),s("value",null),m(2),x(k(41,23,e.paymentMethods$)),m(6),R("ngModel",e.startDate),m(4),R("ngModel",e.endDate),m(3),h((e.user==null?null:e.user.role)===e.userRoles.ADMIN||(e.user==null?null:e.user.role)===e.userRoles.TREASURER?52:-1),m(18),h(e.sortBy==="date"?70:-1),m(3),h(e.sortBy==="memberName"?73:-1),m(3),h(e.sortBy==="contributionTypeType"?76:-1),m(3),h(e.sortBy==="paymentMethodDescription"?79:-1),m(3),h(e.sortBy==="amount"?82:-1),m(3),h((e.user==null?null:e.user.role)===e.userRoles.ADMIN||(e.user==null?null:e.user.role)===e.userRoles.TREASURER?85:-1),m(2),h(e.contributions.length===0?87:88),m(7),I(" ",e.totalContributions," "),m(2),h(e.totalPages>1?96:-1))},dependencies:[Wt,Bt,it,W,B,L,Nt,Ft,Z,tt,N,X,$,Dt,H,Et,Tt],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.attachment-link[_ngcontent-%COMP%]{border-radius:.625rem;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;color:#0b2454;text-decoration:none}.attachment-link[_ngcontent-%COMP%]:hover{background-color:#facc15}.attachment-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;margin-left:.25rem;margin-top:.25rem}@media(max-width:762px){.btn-print[_ngcontent-%COMP%]{height:4rem!important;padding:1rem}}"]})};export{Zt as ContributionsComponent};
