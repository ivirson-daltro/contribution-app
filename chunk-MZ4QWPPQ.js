import{a as me}from"./chunk-GTUJ7HP6.js";import{a as te,b as D}from"./chunk-YWLCHPBO.js";import{a as ie,b as ne,c as oe,d as re,e as ae,f as se,g as R}from"./chunk-VIBL3TNU.js";import{a as $}from"./chunk-2J3QXTNU.js";import{b as j,c as f,d as L,e as G,g as q,h as H,i as W,j as Y,k as J,l as K,m as Q,n as X,o as Z}from"./chunk-765CTO47.js";import"./chunk-5OMQI3NQ.js";import{a as le,b as ce}from"./chunk-P2OKJE6B.js";import{a as k,b as T}from"./chunk-PTM3XZIB.js";import{E as ee}from"./chunk-SY6A7M44.js";import{D as _,Ea as O,O as N,Pa as h,Qa as v,Sa as V,T as g,Ta as F,Ua as A,Va as c,Wa as o,Wb as z,X as b,Xa as n,Xb as B,Y as C,Ya as m,ab as E,bc as M,cb as d,db as p,lb as y,nb as a,ob as w,pb as x,ua as l,ub as I,za as S}from"./chunk-WWQWIYYY.js";import"./chunk-2NFLSA4Y.js";var U=class r{httpClient=g(B);getPaginatedUsers(t=1,e=10,i,s="asc"){let u=new z().set("page",t.toString()).set("limit",e.toString());return i&&(u=u.set("sortBy",i).set("sortDirection",s)),this.httpClient.get(`${M.apiUrl}/users/paginated`,{params:u})}saveUser(t){return this.httpClient.post(`${M.apiUrl}/users`,t)}getById(t){return this.httpClient.get(`${M.apiUrl}/users/${t}`)}updateUser(t,e){return this.httpClient.put(`${M.apiUrl}/users/${t}`,e)}deleteUser(t){return this.httpClient.delete(`${M.apiUrl}/users/${t}`)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=N({token:r,factory:r.\u0275fac,providedIn:"root"})};var P=class r{constructor(t,e,i){this.fb=t;this.dialogRef=e;this.data=i}usersService=g(U);toastService=g(D);form;userRoles=$;ngOnInit(){this.buildForm(),this.data&&this.form.patchValue({name:this.data.name??"",email:this.data.email??""})}buildForm(){this.form=this.fb.group({name:["",[f.required]],email:["",[f.required,f.email]],password:["",[f.required,f.minLength(6)]],confirmPassword:["",[f.required]],role:["",[f.required]]})}submit(){let t=this.form.getRawValue();this.data&&this.data.id?this.updateUser(this.data.id,t):this.saveUser(t)}saveUser(t){this.usersService.saveUser(t).pipe(_()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio cadastrado com sucesso.")},error:e=>{this.toastService.error(e?.error?.error??"Erro ao cadastrar usu\xE1rio.")}})}updateUser(t,e){this.usersService.updateUser(t,e).pipe(_()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio atualizado com sucesso.")},error:i=>{this.toastService.error(i?.error?.error??"Erro ao atualizar usu\xE1rio.")}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||r)(S(Q),S(ie),S(ne))};static \u0275cmp=O({type:r,selectors:[["app-add-users"]],decls:45,vars:9,consts:[[1,"cadastrar-container"],[1,"cadastrar-card"],["mat-dialog-title","",1,"card-title"],[1,"contribution-form",3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","Digite o nome completo","formControlName","name",1,"form-control"],["type","email","placeholder","seu@email.com","formControlName","email",1,"form-control"],[1,"row","mb-3"],[1,"col-12","col-md-6"],["type","password","placeholder","M\xEDnimo 6 caracteres","formControlName","password",1,"form-control"],["type","password","placeholder","Repita a senha","formControlName","confirmPassword",1,"form-control"],[1,"mb-4"],["formControlName","role",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],["align","end",1,"form-footer"],["type","button",1,"btn","cancel-button",3,"click"],["type","submit",1,"btn","btn-primary","submit-button",3,"disabled"],["fontIcon","save",1,"submit-icon"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3),n(),o(4,"form",3),d("ngSubmit",function(){return i.submit()}),o(5,"mat-dialog-content")(6,"div",4)(7,"label",5),a(8,"Nome"),n(),m(9,"input",6),n(),o(10,"div",4)(11,"label",5),a(12,"Email"),n(),m(13,"input",7),n(),o(14,"div",8)(15,"div",9)(16,"label",5),a(17,"Senha"),n(),m(18,"input",10),n(),o(19,"div",9)(20,"label",5),a(21,"Confirmar Senha"),n(),m(22,"input",11),n()(),o(23,"div",12)(24,"label",5),a(25,"Perfil"),n(),o(26,"select",13)(27,"option",14),a(28,"- Selecione"),n(),o(29,"option",15),a(30,"Administrador"),n(),o(31,"option",15),a(32,"Conselho Fiscal"),n(),o(33,"option",15),a(34,"Secret\xE1rio"),n(),o(35,"option",15),a(36,"Tesoureiro"),n(),o(37,"option",15),a(38,"Presidente"),n()()()(),o(39,"mat-dialog-actions",16)(40,"button",17),d("click",function(){return i.close()}),a(41,"Cancelar"),n(),o(42,"button",18),m(43,"mat-icon",19),a(44),n()()()()()),e&2&&(l(3),x("",i.data?"Atualizar":"Novo"," Usu\xE1rio"),l(),c("formGroup",i.form),l(25),c("value",i.userRoles.ADMIN),l(2),c("value",i.userRoles.FISCAL),l(2),c("value",i.userRoles.SECRETARY),l(2),c("value",i.userRoles.TREASURER),l(2),c("value",i.userRoles.PRESIDENT),l(5),c("disabled",i.form.invalid),l(2),x(" ",i.data?"Atualizar":"Cadastrar"," Membro "))},dependencies:[Z,q,J,K,j,Y,L,G,W,H,R,re,se,ae,T,k],styles:[".cadastrar-container[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:700;color:#0b2454}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-body[_ngcontent-%COMP%]{padding-top:.25rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:600;margin-bottom:.35rem;color:#374151}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#f7f9fc;border-radius:.75rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#d1d5db}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#1d4ed8}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #e5e7eb;display:flex;gap:1rem;align-items:center}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:3rem;border-radius:.625rem;background-color:#0b2454;font-weight:600}@media(max-width:600px){.cadastrar-card[_ngcontent-%COMP%]{padding:1.25rem 1.25rem 1.75rem}}"]})};var fe=(r,t)=>t.id;function _e(r,t){if(r&1&&m(0,"mat-icon",15),r&2){let e=p();c("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function be(r,t){if(r&1&&m(0,"mat-icon",15),r&2){let e=p();c("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function Ce(r,t){if(r&1&&m(0,"mat-icon",15),r&2){let e=p();c("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function he(r,t){r&1&&(o(0,"tr")(1,"td",21),a(2," Nenhum usu\xE1rio encontrado. "),n()())}function ve(r,t){if(r&1){let e=E();o(0,"tr")(1,"td"),a(2),n(),o(3,"td"),a(4),n(),o(5,"td"),a(6),n(),o(7,"td",16)(8,"button",22),d("click",function(){let s=b(e).$implicit,u=p(2);return C(u.editUser(s.id))}),m(9,"mat-icon",23),n(),o(10,"button",24),d("click",function(){let s=b(e).$implicit,u=p(2);return C(u.deleteUser(s.id))}),m(11,"mat-icon",25),n()()()}if(r&2){let e=t.$implicit;l(2),w(e.name),l(2),w(e.email),l(2),w(e.role==="ADMIN"?"Administrador":"Usu\xE1rio")}}function xe(r,t){if(r&1&&F(0,ve,12,3,"tr",null,fe),r&2){let e=p();A(e.users)}}function Me(r,t){if(r&1){let e=E();o(0,"li",27)(1,"button",30),d("click",function(){let s=b(e).$implicit,u=p(2);return C(u.goToPage(s))}),a(2),n()()}if(r&2){let e=t.$implicit,i=p(2);y("active",i.pageIndex===e),l(2),x(" ",e+1," ")}}function Ue(r,t){if(r&1){let e=E();o(0,"nav",20)(1,"ul",26)(2,"li",27)(3,"button",28),d("click",function(){b(e);let s=p();return C(s.goToPage(s.pageIndex-1))}),a(4," Anterior "),n()(),F(5,Me,3,3,"li",29,V),o(7,"li",27)(8,"button",28),d("click",function(){b(e);let s=p();return C(s.goToPage(s.pageIndex+1))}),a(9," Pr\xF3xima "),n()()()()}if(r&2){let e=p();l(2),y("disabled",e.pageIndex===0),l(),c("disabled",e.pageIndex===0),l(2),A(e.pages),l(2),y("disabled",e.pageIndex>=e.totalPages-1),l(),c("disabled",e.pageIndex>=e.totalPages-1)}}var pe=class r{usersService=g(U);dialog=g(oe);toastService=g(D);form;users=[];totalUsers=0;pageIndex=0;pageSize=10;sortBy="name";sortDirection="asc";ngOnInit(){this.getUserList()}openNewUser(){this.dialog.open(P,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(e=>{e&&this.getUserList()})}getUserList(t=this.pageIndex,e=this.pageSize){let i=t+1;this.usersService.getPaginatedUsers(i,e,this.sortBy,this.sortDirection).pipe(_()).subscribe(s=>{if(!s){this.users=[],this.totalUsers=0;return}this.users=s.data??[],this.totalUsers=s.total??0,this.pageIndex=(s.page??i)-1,this.pageSize=s.limit??e})}get totalPages(){return this.pageSize>0?Math.ceil(this.totalUsers/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(t,e)=>e)}goToPage(t){t<0||t>=this.totalPages||t===this.pageIndex||(this.pageIndex=t,this.getUserList(this.pageIndex,this.pageSize))}changeSort(t){this.sortBy===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=t,this.sortDirection="asc"),this.pageIndex=0,this.getUserList(0,this.pageSize)}editUser(t){this.usersService.getById(t).pipe(_()).subscribe({next:e=>{this.dialog.open(P,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:e}).afterClosed().subscribe(s=>{s&&this.getUserList()})},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao buscar dados do usu\xE1rio")}})}deleteUser(t){this.dialog.open(me,{width:"400px",data:{title:"Excluir Usu\xE1rio",subtitle:"Tem certeza que deseja excluir este usu\xE1rio?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(i=>{i&&this.onDeleteUser(t)})}onDeleteUser(t){this.usersService.deleteUser(t).pipe(_()).subscribe({next:()=>{this.toastService.success("Usu\xE1rio exclu\xEDdo com sucesso."),this.getUserList()},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao excluir o usu\xE1rio")}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-users"]],decls:41,vars:6,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["colspan","6",1,"text-center","text-muted","small","py-4"],["aria-label","Editar Usu\xE1rio",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Usu\xE1rio",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Usu\xE1rios"),n(),o(5,"p",4),a(6,"Visualize e gerencie os usu\xE1rios cadastrados"),n()(),o(7,"div",5)(8,"button",6),d("click",function(){return i.openNewUser()}),m(9,"mat-icon",7),a(10," Novo Usu\xE1rio "),n()()(),o(11,"div",8)(12,"mat-card",9)(13,"h2",10),a(14,"Usu\xE1rios"),n(),o(15,"div",11)(16,"table",12)(17,"thead",13)(18,"tr")(19,"th",14),d("click",function(){return i.changeSort("name")}),a(20," Nome "),h(21,_e,1,2,"mat-icon",15),n(),o(22,"th",14),d("click",function(){return i.changeSort("email")}),a(23," Email "),h(24,be,1,2,"mat-icon",15),n(),o(25,"th",14),d("click",function(){return i.changeSort("role")}),a(26," Perfil "),h(27,Ce,1,2,"mat-icon",15),n(),o(28,"th",16),a(29,"A\xE7\xF5es"),n()()(),o(30,"tbody"),h(31,he,3,0,"tr")(32,xe,2,0),n()()(),o(33,"div",17)(34,"div",18)(35,"p",19)(36,"strong"),a(37,"Total de usu\xE1rios:"),n(),a(38),n()(),o(39,"div",18),h(40,Ue,10,6,"nav",20),n()()()()()),e&2&&(l(21),v(i.sortBy==="name"?21:-1),l(3),v(i.sortBy==="email"?24:-1),l(3),v(i.sortBy==="role"?27:-1),l(4),v(i.users.length===0?31:32),l(7),x(" ",i.totalUsers),l(2),v(i.totalPages>1?40:-1))},dependencies:[ce,le,ee,T,k,R,te,X],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};export{pe as UsersComponent};
