import{a as Me,b as xe,c as Ue,d as Pe,e as Se,f as Oe,g as Ee}from"./chunk-25RZTJKE.js";import{a as we,b as ye}from"./chunk-XW5Q54DX.js";import{a as pe,b as F}from"./chunk-VZNXFT7U.js";import"./chunk-TAR3LFPR.js";import{a as ue,b as _e,c as fe,d as ge,e as be,f as Ce,g as A}from"./chunk-P74SJGKF.js";import{a as T}from"./chunk-2J3QXTNU.js";import{c as Q,e as V,g as X,h as Z,j as ee,l as te,m as ie,n as oe,o as ne,p as re,q as ae,r as se,s as le,t as ce,u as me}from"./chunk-GFUDPGUP.js";import{a as he,b as ve}from"./chunk-PNOVXD2Q.js";import{a as k,b as R}from"./chunk-7WCVQ4OW.js";import{L as de}from"./chunk-QK5Q5MQS.js";import{$ as f,$a as S,Ab as v,Da as E,E as b,Fb as I,Ia as w,Jb as W,K as B,Kb as H,L as z,R as L,W as u,Wa as C,Xa as h,Ya as j,Za as G,_,_a as P,ab as c,bb as r,c as N,cb as a,db as g,gc as Y,hb as M,jb as m,kb as d,m as $,nc as J,oc as K,ub as q,uc as x,wb as y,ya as l,yb as s,zb as D}from"./chunk-3U63YFDR.js";import"./chunk-7CGTOI24.js";var U=class o{httpClient=u(K);getPaginatedUsers(t=1,e=10,i,n="asc"){let p=new J().set("page",t.toString()).set("limit",e.toString());return i&&(p=p.set("sortBy",i).set("sortDirection",n)),this.httpClient.get(`${x.apiUrl}/users/paginated`,{params:p})}saveUser(t){return this.httpClient.post(`${x.apiUrl}/users`,t)}getById(t){return this.httpClient.get(`${x.apiUrl}/users/${t}`)}updateUser(t,e){return this.httpClient.put(`${x.apiUrl}/users/${t}`,e)}deleteUser(t){return this.httpClient.delete(`${x.apiUrl}/users/${t}`)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})};function Ae(o,t){if(o&1&&(r(0,"mat-option",10),s(1),a()),o&2){let e=t.$implicit;c("value",e),l(),v(" ",e.name," ")}}var O=class o{constructor(t,e,i){this.fb=t;this.dialogRef=e;this.data=i}usersService=u(U);toastService=u(F);membersService=u(we);form;userRoles=T;members$=this.membersService.getMembers();filteredMembers$=new N;memberSearchControl=new ee("",{nonNullable:!0});ngOnInit(){this.buildForm(),this.data&&this.form.patchValue({memberId:this.data.memberId??""}),this.filteredMembers$=this.memberSearchControl.valueChanges.pipe(B(""),z(t=>this.members$.pipe($(e=>{let i=typeof t=="string"?t.toLowerCase():"";return i?e.filter(n=>n.name.toLowerCase().includes(i)):e}))))}onMemberSelected(t){this.form.get("memberId")?.setValue(t.id),this.memberSearchControl.setValue(t.name,{emitEvent:!1})}buildForm(){this.form=this.fb.group({memberId:["",[V.required]],role:["",[V.required]]})}submit(){let t=this.form.getRawValue();this.data&&this.data.id?this.updateUser(this.data.id,t):this.saveUser(t)}saveUser(t){this.usersService.saveUser(t).pipe(b()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio cadastrado com sucesso.")},error:e=>{this.toastService.error(e?.error?.error??"Erro ao cadastrar usu\xE1rio.")}})}updateUser(t,e){this.usersService.updateUser(t,e).pipe(b()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio atualizado com sucesso.")},error:i=>{this.toastService.error(i?.error?.error??"Erro ao atualizar usu\xE1rio.")}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)(E(le),E(ue),E(_e))};static \u0275cmp=w({type:o,selectors:[["app-add-users"]],decls:38,vars:13,consts:[["autoMember","matAutocomplete"],[1,"cadastrar-container"],[1,"cadastrar-card"],["mat-dialog-title","",1,"card-title"],[1,"contribution-form",3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"col-md-8"],["for","memberId",1,"form-label"],["type","text","matInput","","placeholder","Buscar membro",1,"form-control",3,"formControl","matAutocomplete"],[3,"optionSelected"],[3,"value"],[1,"mb-4"],[1,"form-label"],["formControlName","role",1,"form-control"],["value","","disabled","","selected",""],["align","end",1,"form-footer"],["type","button",1,"btn","cancel-button",3,"click"],["type","submit",1,"btn","btn-primary","submit-button",3,"disabled"],["fontIcon","save",1,"submit-icon"]],template:function(e,i){if(e&1){let n=M();r(0,"div",1)(1,"div",2)(2,"h2",3),s(3),a(),r(4,"form",4),m("ngSubmit",function(){return _(n),f(i.submit())}),r(5,"mat-dialog-content")(6,"div",5)(7,"div",6)(8,"label",7),s(9,"Membro"),a(),g(10,"input",8),r(11,"mat-autocomplete",9,0),m("optionSelected",function(ke){return _(n),f(i.onMemberSelected(ke.option.value))}),P(13,Ae,2,2,"mat-option",10,j),W(15,"async"),a()()(),r(16,"div",11)(17,"label",12),s(18,"Perfil"),a(),r(19,"select",13)(20,"option",14),s(21,"- Selecione"),a(),r(22,"option",10),s(23,"Administrador"),a(),r(24,"option",10),s(25,"Conselho Fiscal"),a(),r(26,"option",10),s(27,"Secret\xE1rio"),a(),r(28,"option",10),s(29,"Tesoureiro"),a(),r(30,"option",10),s(31,"Presidente"),a()()()(),r(32,"mat-dialog-actions",15)(33,"button",16),m("click",function(){return _(n),f(i.close())}),s(34,"Cancelar"),a(),r(35,"button",17),g(36,"mat-icon",18),s(37),a()()()()()}if(e&2){let n=q(12);l(3),v("",i.data?"Atualizar":"Novo"," Usu\xE1rio"),l(),c("formGroup",i.form),l(6),c("formControl",i.memberSearchControl)("matAutocomplete",n),l(3),S(H(15,11,i.filteredMembers$)),l(9),c("value",i.userRoles.ADMIN),l(2),c("value",i.userRoles.FISCAL),l(2),c("value",i.userRoles.SECRETARY),l(2),c("value",i.userRoles.TREASURER),l(2),c("value",i.userRoles.PRESIDENT),l(5),c("disabled",i.form.invalid),l(2),v(" ",i.data?"Atualizar":"Cadastrar"," Usu\xE1rio ")}},dependencies:[me,te,ae,se,Q,re,X,Z,ie,ne,oe,A,ge,Ce,be,R,k,Oe,Se,Pe,xe,Me,Ue,Ee,Y],styles:[".cadastrar-container[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:700;color:#0b2454}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-body[_ngcontent-%COMP%]{padding-top:.25rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:600;margin-bottom:.35rem;color:#374151}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#f7f9fc;border-radius:.75rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#d1d5db}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#1d4ed8}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #e5e7eb;display:flex;gap:1rem;align-items:center}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:3rem;border-radius:.625rem;background-color:#0b2454;font-weight:600}[_nghost-%COMP%]     .cdk-overlay-pane .mat-mdc-autocomplete-panel{background-color:#fff!important}[_nghost-%COMP%]     .mat-mdc-option{background-color:#fff}[_nghost-%COMP%]     .mat-mdc-option.mdc-list-item--activated, [_nghost-%COMP%]     .mat-mdc-option.mdc-list-item--selected{background-color:#f5f5f5}.autocomplete-wrapper[_ngcontent-%COMP%]{position:relative;width:100%}.autocomplete-list[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;z-index:10;background:#fff;border:1px solid #ddd;border-radius:0 0 4px 4px;max-height:200px;overflow-y:auto;margin:0;padding:0;list-style:none}.autocomplete-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer;transition:background .2s}.autocomplete-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#f5f5f5}.autocomplete-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{background:#e3e3e3;font-weight:700}@media(max-width:600px){.cadastrar-card[_ngcontent-%COMP%]{padding:1.25rem 1.25rem 1.75rem}}"]})};var De=(o,t)=>t.id;function Ve(o,t){if(o&1&&g(0,"mat-icon",15),o&2){let e=d();c("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function Ne(o,t){if(o&1&&g(0,"mat-icon",15),o&2){let e=d();c("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function $e(o,t){if(o&1&&g(0,"mat-icon",15),o&2){let e=d();c("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function Be(o,t){o&1&&(r(0,"tr")(1,"td",21),s(2," Nenhum usu\xE1rio encontrado. "),a()())}function ze(o,t){o&1&&s(0," Administrador ")}function Le(o,t){o&1&&s(0," Tesoureiro(a) ")}function je(o,t){o&1&&s(0," Secret\xE1rio(a) ")}function Ge(o,t){o&1&&s(0," Conselho Fiscal ")}function qe(o,t){o&1&&s(0," Presidente ")}function We(o,t){o&1&&s(0," Usu\xE1rio ")}function He(o,t){if(o&1){let e=M();r(0,"tr")(1,"td"),s(2),a(),r(3,"td"),s(4),a(),r(5,"td"),C(6,ze,1,0)(7,Le,1,0)(8,je,1,0)(9,Ge,1,0)(10,qe,1,0)(11,We,1,0),a(),r(12,"td",16)(13,"button",22),m("click",function(){let n=_(e).$implicit,p=d(2);return f(p.editUser(n.id))}),g(14,"mat-icon",23),a(),r(15,"button",24),m("click",function(){let n=_(e).$implicit,p=d(2);return f(p.deleteUser(n.id))}),g(16,"mat-icon",25),a()()()}if(o&2){let e,i=t.$implicit,n=d(2);l(2),D(i.member==null?null:i.member.name),l(2),D(i.member==null?null:i.member.email),l(2),h((e=i.role)===n.userRoles.ADMIN?6:e===n.userRoles.TREASURER?7:e===n.userRoles.SECRETARY?8:e===n.userRoles.FISCAL?9:e===n.userRoles.PRESIDENT?10:11)}}function Ye(o,t){if(o&1&&P(0,He,17,3,"tr",null,De),o&2){let e=d();S(e.users)}}function Je(o,t){if(o&1){let e=M();r(0,"li",27)(1,"button",30),m("click",function(){let n=_(e).$implicit,p=d(2);return f(p.goToPage(n))}),s(2),a()()}if(o&2){let e=t.$implicit,i=d(2);y("active",i.pageIndex===e),l(2),v(" ",e+1," ")}}function Ke(o,t){if(o&1){let e=M();r(0,"nav",20)(1,"ul",26)(2,"li",27)(3,"button",28),m("click",function(){_(e);let n=d();return f(n.goToPage(n.pageIndex-1))}),s(4," Anterior "),a()(),P(5,Je,3,3,"li",29,G),r(7,"li",27)(8,"button",28),m("click",function(){_(e);let n=d();return f(n.goToPage(n.pageIndex+1))}),s(9," Pr\xF3xima "),a()()()()}if(o&2){let e=d();l(2),y("disabled",e.pageIndex===0),l(),c("disabled",e.pageIndex===0),l(2),S(e.pages),l(2),y("disabled",e.pageIndex>=e.totalPages-1),l(),c("disabled",e.pageIndex>=e.totalPages-1)}}var Te=class o{usersService=u(U);dialog=u(fe);toastService=u(F);form;users=[];totalUsers=0;pageIndex=0;pageSize=10;sortBy="name";sortDirection="asc";userRoles=T;ngOnInit(){this.getUserList()}openNewUser(){this.dialog.open(O,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(e=>{e&&this.getUserList()})}getUserList(t=this.pageIndex,e=this.pageSize){let i=t+1;this.usersService.getPaginatedUsers(i,e,this.sortBy,this.sortDirection).pipe(b()).subscribe(n=>{if(!n){this.users=[],this.totalUsers=0;return}this.users=n.data??[],this.totalUsers=n.total??0,this.pageIndex=(n.page??i)-1,this.pageSize=n.limit??e})}get totalPages(){return this.pageSize>0?Math.ceil(this.totalUsers/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(t,e)=>e)}goToPage(t){t<0||t>=this.totalPages||t===this.pageIndex||(this.pageIndex=t,this.getUserList(this.pageIndex,this.pageSize))}changeSort(t){this.sortBy===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=t,this.sortDirection="asc"),this.pageIndex=0,this.getUserList(0,this.pageSize)}editUser(t){this.usersService.getById(t).pipe(b()).subscribe({next:e=>{this.dialog.open(O,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:e}).afterClosed().subscribe(n=>{n&&this.getUserList()})},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao buscar dados do usu\xE1rio")}})}deleteUser(t){this.dialog.open(ye,{width:"400px",data:{title:"Excluir Usu\xE1rio",subtitle:"Tem certeza que deseja excluir este usu\xE1rio?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(i=>{i&&this.onDeleteUser(t)})}onDeleteUser(t){this.usersService.deleteUser(t).pipe(b()).subscribe({next:()=>{this.toastService.success("Usu\xE1rio exclu\xEDdo com sucesso."),this.getUserList()},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao excluir o usu\xE1rio")}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["app-users"]],decls:41,vars:6,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["colspan","6",1,"text-center","text-muted","small","py-4"],["aria-label","Editar Usu\xE1rio",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Usu\xE1rio",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4,"Usu\xE1rios"),a(),r(5,"p",4),s(6,"Visualize e gerencie os usu\xE1rios cadastrados"),a()(),r(7,"div",5)(8,"button",6),m("click",function(){return i.openNewUser()}),g(9,"mat-icon",7),s(10," Novo Usu\xE1rio "),a()()(),r(11,"div",8)(12,"mat-card",9)(13,"h2",10),s(14,"Usu\xE1rios"),a(),r(15,"div",11)(16,"table",12)(17,"thead",13)(18,"tr")(19,"th",14),m("click",function(){return i.changeSort("name")}),s(20," Nome "),C(21,Ve,1,2,"mat-icon",15),a(),r(22,"th",14),m("click",function(){return i.changeSort("email")}),s(23," Email "),C(24,Ne,1,2,"mat-icon",15),a(),r(25,"th",14),m("click",function(){return i.changeSort("role")}),s(26," Perfil "),C(27,$e,1,2,"mat-icon",15),a(),r(28,"th",16),s(29,"A\xE7\xF5es"),a()()(),r(30,"tbody"),C(31,Be,3,0,"tr")(32,Ye,2,0),a()()(),r(33,"div",17)(34,"div",18)(35,"p",19)(36,"strong"),s(37,"Total de usu\xE1rios:"),a(),s(38),a()(),r(39,"div",18),C(40,Ke,10,6,"nav",20),a()()()()()),e&2&&(l(21),h(i.sortBy==="name"?21:-1),l(3),h(i.sortBy==="email"?24:-1),l(3),h(i.sortBy==="role"?27:-1),l(4),h(i.users.length===0?31:32),l(7),v(" ",i.totalUsers),l(2),h(i.totalPages>1?40:-1))},dependencies:[ve,he,de,R,k,A,pe,ce],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};export{Te as UsersComponent};
