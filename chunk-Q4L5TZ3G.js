import{a as le}from"./chunk-3QZXM3DZ.js";import{a as ee,b as T}from"./chunk-2XGJICP7.js";import{a as te,b as ie,c as ne,d as oe,e as re,f as ae,g as F}from"./chunk-L6BUXOCN.js";import{b as $,c as f,d as j,e as L,g as G,h as q,i as H,j as W,k as J,l as K,m as Q,n as X,o as Y}from"./chunk-PZJSAPWP.js";import"./chunk-U462Y6UM.js";import{a as se,b as ce}from"./chunk-V6GMYO7R.js";import{a as k,b as D}from"./chunk-WI34YPH7.js";import{E as Z}from"./chunk-4QMG3DVJ.js";import{D as _,Ea as O,O as R,Pa as h,Qa as v,Sa as V,T as p,Ta as N,Ua as A,Va as g,Vb as z,Wa as o,Wb as B,X as b,Xa as i,Y as C,Ya as l,ab as w,ac as M,cb as m,db as d,lb as E,nb as a,ob as y,pb as x,ua as c,ub as I,za as S}from"./chunk-X2WIBWUX.js";import"./chunk-2NFLSA4Y.js";var U=class r{httpClient=p(B);getPaginatedUsers(t=1,e=10,n,s="asc"){let u=new z().set("page",t.toString()).set("limit",e.toString());return n&&(u=u.set("sortBy",n).set("sortDirection",s)),this.httpClient.get(`${M.apiUrl}/auth/users/paginated`,{params:u})}saveUser(t){return this.httpClient.post(`${M.apiUrl}/auth/users`,t)}getById(t){return this.httpClient.get(`${M.apiUrl}/auth/users/${t}`)}updateUser(t,e){return this.httpClient.put(`${M.apiUrl}/auth/users/${t}`,e)}deleteUser(t){return this.httpClient.delete(`${M.apiUrl}/auth/users/${t}`)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};var P=class r{constructor(t,e,n){this.fb=t;this.dialogRef=e;this.data=n}usersService=p(U);toastService=p(T);form;ngOnInit(){this.buildForm(),this.data&&this.form.patchValue({name:this.data.name??"",email:this.data.email??""})}buildForm(){this.form=this.fb.group({name:["",[f.required]],email:["",[f.required,f.email]],password:["",[f.required,f.minLength(6)]],confirmPassword:["",[f.required]],role:["",[f.required]]})}submit(){let t=this.form.getRawValue();this.data&&this.data.id?this.updateUser(this.data.id,t):this.saveUser(t)}saveUser(t){this.usersService.saveUser(t).pipe(_()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio cadastrado com sucesso.")},error:e=>{this.toastService.error(e?.error?.error??"Erro ao cadastrar usu\xE1rio.")}})}updateUser(t,e){this.usersService.updateUser(t,e).pipe(_()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio atualizado com sucesso.")},error:n=>{this.toastService.error(n?.error?.error??"Erro ao atualizar usu\xE1rio.")}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||r)(S(Q),S(te),S(ie))};static \u0275cmp=O({type:r,selectors:[["app-add-users"]],decls:39,vars:4,consts:[[1,"cadastrar-container"],[1,"cadastrar-card"],["mat-dialog-title","",1,"card-title"],[1,"contribution-form",3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","Digite o nome completo","formControlName","name",1,"form-control"],["type","email","placeholder","seu@email.com","formControlName","email",1,"form-control"],[1,"row","mb-3"],[1,"col-12","col-md-6"],["type","password","placeholder","M\xEDnimo 6 caracteres","formControlName","password",1,"form-control"],["type","password","placeholder","Repita a senha","formControlName","confirmPassword",1,"form-control"],[1,"mb-4"],["formControlName","role",1,"form-control"],["value","","disabled","","selected",""],["value","ADMIN"],["value","USER"],["align","end",1,"form-footer"],["type","button",1,"btn","cancel-button",3,"click"],["type","submit",1,"btn","btn-primary","submit-button",3,"disabled"],["fontIcon","save",1,"submit-icon"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3),i(),o(4,"form",3),m("ngSubmit",function(){return n.submit()}),o(5,"mat-dialog-content")(6,"div",4)(7,"label",5),a(8,"Nome"),i(),l(9,"input",6),i(),o(10,"div",4)(11,"label",5),a(12,"Email"),i(),l(13,"input",7),i(),o(14,"div",8)(15,"div",9)(16,"label",5),a(17,"Senha"),i(),l(18,"input",10),i(),o(19,"div",9)(20,"label",5),a(21,"Confirmar Senha"),i(),l(22,"input",11),i()(),o(23,"div",12)(24,"label",5),a(25,"Perfil"),i(),o(26,"select",13)(27,"option",14),a(28,"- Selecione"),i(),o(29,"option",15),a(30,"Administrador"),i(),o(31,"option",16),a(32,"Usu\xE1rio"),i()()()(),o(33,"mat-dialog-actions",17)(34,"button",18),m("click",function(){return n.close()}),a(35,"Cancelar"),i(),o(36,"button",19),l(37,"mat-icon",20),a(38),i()()()()()),e&2&&(c(3),x("",n.data?"Atualizar":"Novo"," Usu\xE1rio"),c(),g("formGroup",n.form),c(32),g("disabled",n.form.invalid),c(2),x(" ",n.data?"Atualizar":"Cadastrar"," Membro "))},dependencies:[Y,G,J,K,$,W,j,L,H,q,F,oe,ae,re,D,k],styles:[".cadastrar-container[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:700;color:#0b2454}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-body[_ngcontent-%COMP%]{padding-top:.25rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:600;margin-bottom:.35rem;color:#374151}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#f7f9fc;border-radius:.75rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#d1d5db}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#1d4ed8}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #e5e7eb;display:flex;gap:1rem;align-items:center}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:3rem;border-radius:.625rem;background-color:#0b2454;font-weight:600}@media(max-width:600px){.cadastrar-card[_ngcontent-%COMP%]{padding:1.25rem 1.25rem 1.75rem}}"]})};var ge=(r,t)=>t.id;function fe(r,t){if(r&1&&l(0,"mat-icon",15),r&2){let e=d();g("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function _e(r,t){if(r&1&&l(0,"mat-icon",15),r&2){let e=d();g("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function be(r,t){if(r&1&&l(0,"mat-icon",15),r&2){let e=d();g("fontIcon",I(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function Ce(r,t){r&1&&(o(0,"tr")(1,"td",21),a(2," Nenhum usu\xE1rio encontrado. "),i()())}function he(r,t){if(r&1){let e=w();o(0,"tr")(1,"td"),a(2),i(),o(3,"td"),a(4),i(),o(5,"td"),a(6),i(),o(7,"td",16)(8,"button",22),m("click",function(){let s=b(e).$implicit,u=d(2);return C(u.editUser(s.id))}),l(9,"mat-icon",23),i(),o(10,"button",24),m("click",function(){let s=b(e).$implicit,u=d(2);return C(u.deleteUser(s.id))}),l(11,"mat-icon",25),i()()()}if(r&2){let e=t.$implicit;c(2),y(e.name),c(2),y(e.email),c(2),y(e.role==="ADMIN"?"Administrador":"Usu\xE1rio")}}function ve(r,t){if(r&1&&N(0,he,12,3,"tr",null,ge),r&2){let e=d();A(e.users)}}function xe(r,t){if(r&1){let e=w();o(0,"li",27)(1,"button",30),m("click",function(){let s=b(e).$implicit,u=d(2);return C(u.goToPage(s))}),a(2),i()()}if(r&2){let e=t.$implicit,n=d(2);E("active",n.pageIndex===e),c(2),x(" ",e+1," ")}}function Me(r,t){if(r&1){let e=w();o(0,"nav",20)(1,"ul",26)(2,"li",27)(3,"button",28),m("click",function(){b(e);let s=d();return C(s.goToPage(s.pageIndex-1))}),a(4," Anterior "),i()(),N(5,xe,3,3,"li",29,V),o(7,"li",27)(8,"button",28),m("click",function(){b(e);let s=d();return C(s.goToPage(s.pageIndex+1))}),a(9," Pr\xF3xima "),i()()()()}if(r&2){let e=d();c(2),E("disabled",e.pageIndex===0),c(),g("disabled",e.pageIndex===0),c(2),A(e.pages),c(2),E("disabled",e.pageIndex>=e.totalPages-1),c(),g("disabled",e.pageIndex>=e.totalPages-1)}}var de=class r{usersService=p(U);dialog=p(ne);toastService=p(T);form;users=[];totalUsers=0;pageIndex=0;pageSize=10;sortBy="name";sortDirection="asc";ngOnInit(){this.getUserList()}openNewUser(){this.dialog.open(P,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(e=>{e&&this.getUserList()})}getUserList(t=this.pageIndex,e=this.pageSize){let n=t+1;this.usersService.getPaginatedUsers(n,e,this.sortBy,this.sortDirection).pipe(_()).subscribe(s=>{if(!s){this.users=[],this.totalUsers=0;return}this.users=s.data??[],this.totalUsers=s.total??0,this.pageIndex=(s.page??n)-1,this.pageSize=s.limit??e})}get totalPages(){return this.pageSize>0?Math.ceil(this.totalUsers/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(t,e)=>e)}goToPage(t){t<0||t>=this.totalPages||t===this.pageIndex||(this.pageIndex=t,this.getUserList(this.pageIndex,this.pageSize))}changeSort(t){this.sortBy===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=t,this.sortDirection="asc"),this.pageIndex=0,this.getUserList(0,this.pageSize)}editUser(t){this.usersService.getById(t).pipe(_()).subscribe({next:e=>{this.dialog.open(P,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:e}).afterClosed().subscribe(s=>{s&&this.getUserList()})},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao buscar dados do usu\xE1rio")}})}deleteUser(t){this.dialog.open(le,{width:"400px",data:{title:"Excluir Usu\xE1rio",subtitle:"Tem certeza que deseja excluir este usu\xE1rio?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(n=>{n&&this.onDeleteUser(t)})}onDeleteUser(t){this.usersService.deleteUser(t).pipe(_()).subscribe({next:()=>{this.toastService.success("Usu\xE1rio exclu\xEDdo com sucesso."),this.getUserList()},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao excluir o usu\xE1rio")}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-users"]],decls:41,vars:6,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["colspan","6",1,"text-center","text-muted","small","py-4"],["aria-label","Editar Usu\xE1rio",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Usu\xE1rio",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Usu\xE1rios"),i(),o(5,"p",4),a(6,"Visualize e gerencie os usu\xE1rios cadastrados"),i()(),o(7,"div",5)(8,"button",6),m("click",function(){return n.openNewUser()}),l(9,"mat-icon",7),a(10," Novo Usu\xE1rio "),i()()(),o(11,"div",8)(12,"mat-card",9)(13,"h2",10),a(14,"Usu\xE1rios"),i(),o(15,"div",11)(16,"table",12)(17,"thead",13)(18,"tr")(19,"th",14),m("click",function(){return n.changeSort("name")}),a(20," Nome "),h(21,fe,1,2,"mat-icon",15),i(),o(22,"th",14),m("click",function(){return n.changeSort("email")}),a(23," Email "),h(24,_e,1,2,"mat-icon",15),i(),o(25,"th",14),m("click",function(){return n.changeSort("role")}),a(26," Perfil "),h(27,be,1,2,"mat-icon",15),i(),o(28,"th",16),a(29,"A\xE7\xF5es"),i()()(),o(30,"tbody"),h(31,Ce,3,0,"tr")(32,ve,2,0),i()()(),o(33,"div",17)(34,"div",18)(35,"p",19)(36,"strong"),a(37,"Total de usu\xE1rios:"),i(),a(38),i()(),o(39,"div",18),h(40,Me,10,6,"nav",20),i()()()()()),e&2&&(c(21),v(n.sortBy==="name"?21:-1),c(3),v(n.sortBy==="email"?24:-1),c(3),v(n.sortBy==="role"?27:-1),c(4),v(n.users.length===0?31:32),c(7),x(" ",n.totalUsers),c(2),v(n.totalPages>1?40:-1))},dependencies:[ce,se,Z,D,k,F,ee,X],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};export{de as UsersComponent};
