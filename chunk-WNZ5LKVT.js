import{a as me}from"./chunk-FLNFMLDM.js";import{a as te,b as k}from"./chunk-VUMHNUOQ.js";import{a as ie,b as ne,c as oe,d as re,e as ae,f as se,g as D}from"./chunk-67WNXVEK.js";import{a as I}from"./chunk-2J3QXTNU.js";import{c as j,e as f,g as L,h as G,l as q,n as H,o as W,p as Y,q as J,r as K,s as Q,t as X,u as Z}from"./chunk-TP3L7WKP.js";import{a as le,b as ce}from"./chunk-4YAHTSGF.js";import{a as T,b as R}from"./chunk-AIT4FG67.js";import{L as ee}from"./chunk-2QDRHWMO.js";import{$ as v,$a as A,Ab as x,Da as S,E as g,Fb as w,Ia as E,R as V,W as _,Wa as C,Xa as b,Za as z,_ as h,_a as F,ab as c,bb as a,cb as o,db as m,hb as O,jb as d,kb as p,nc as B,oc as $,uc as U,wb as y,ya as l,yb as r,zb as N}from"./chunk-XFQJZCCP.js";import"./chunk-7CGTOI24.js";var M=class i{httpClient=_($);getPaginatedUsers(t=1,e=10,n,s="asc"){let u=new B().set("page",t.toString()).set("limit",e.toString());return n&&(u=u.set("sortBy",n).set("sortDirection",s)),this.httpClient.get(`${U.apiUrl}/users/paginated`,{params:u})}saveUser(t){return this.httpClient.post(`${U.apiUrl}/users`,t)}getById(t){return this.httpClient.get(`${U.apiUrl}/users/${t}`)}updateUser(t,e){return this.httpClient.put(`${U.apiUrl}/users/${t}`,e)}deleteUser(t){return this.httpClient.delete(`${U.apiUrl}/users/${t}`)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})};var P=class i{constructor(t,e,n){this.fb=t;this.dialogRef=e;this.data=n}usersService=_(M);toastService=_(k);form;userRoles=I;ngOnInit(){this.buildForm(),this.data&&this.form.patchValue({name:this.data.name??"",email:this.data.email??""})}buildForm(){this.form=this.fb.group({name:["",[f.required]],email:["",[f.required,f.email]],password:["",[f.required,f.minLength(6)]],confirmPassword:["",[f.required]],role:["",[f.required]]})}submit(){let t=this.form.getRawValue();this.data&&this.data.id?this.updateUser(this.data.id,t):this.saveUser(t)}saveUser(t){this.usersService.saveUser(t).pipe(g()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio cadastrado com sucesso.")},error:e=>{this.toastService.error(e?.error?.error??"Erro ao cadastrar usu\xE1rio.")}})}updateUser(t,e){this.usersService.updateUser(t,e).pipe(g()).subscribe({next:()=>{this.dialogRef.close(!0),this.toastService.success("Usu\xE1rio atualizado com sucesso.")},error:n=>{this.toastService.error(n?.error?.error??"Erro ao atualizar usu\xE1rio.")}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||i)(S(Q),S(ie),S(ne))};static \u0275cmp=E({type:i,selectors:[["app-add-users"]],decls:45,vars:9,consts:[[1,"cadastrar-container"],[1,"cadastrar-card"],["mat-dialog-title","",1,"card-title"],[1,"contribution-form",3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","Digite o nome completo","formControlName","name",1,"form-control"],["type","email","placeholder","seu@email.com","formControlName","email",1,"form-control"],[1,"row","mb-3"],[1,"col-12","col-md-6"],["type","password","placeholder","M\xEDnimo 6 caracteres","formControlName","password",1,"form-control"],["type","password","placeholder","Repita a senha","formControlName","confirmPassword",1,"form-control"],[1,"mb-4"],["formControlName","role",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],["align","end",1,"form-footer"],["type","button",1,"btn","cancel-button",3,"click"],["type","submit",1,"btn","btn-primary","submit-button",3,"disabled"],["fontIcon","save",1,"submit-icon"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),r(3),o(),a(4,"form",3),d("ngSubmit",function(){return n.submit()}),a(5,"mat-dialog-content")(6,"div",4)(7,"label",5),r(8,"Nome"),o(),m(9,"input",6),o(),a(10,"div",4)(11,"label",5),r(12,"Email"),o(),m(13,"input",7),o(),a(14,"div",8)(15,"div",9)(16,"label",5),r(17,"Senha"),o(),m(18,"input",10),o(),a(19,"div",9)(20,"label",5),r(21,"Confirmar Senha"),o(),m(22,"input",11),o()(),a(23,"div",12)(24,"label",5),r(25,"Perfil"),o(),a(26,"select",13)(27,"option",14),r(28,"- Selecione"),o(),a(29,"option",15),r(30,"Administrador"),o(),a(31,"option",15),r(32,"Conselho Fiscal"),o(),a(33,"option",15),r(34,"Secret\xE1rio"),o(),a(35,"option",15),r(36,"Tesoureiro"),o(),a(37,"option",15),r(38,"Presidente"),o()()()(),a(39,"mat-dialog-actions",16)(40,"button",17),d("click",function(){return n.close()}),r(41,"Cancelar"),o(),a(42,"button",18),m(43,"mat-icon",19),r(44),o()()()()()),e&2&&(l(3),x("",n.data?"Atualizar":"Novo"," Usu\xE1rio"),l(),c("formGroup",n.form),l(25),c("value",n.userRoles.ADMIN),l(2),c("value",n.userRoles.FISCAL),l(2),c("value",n.userRoles.SECRETARY),l(2),c("value",n.userRoles.TREASURER),l(2),c("value",n.userRoles.PRESIDENT),l(5),c("disabled",n.form.invalid),l(2),x(" ",n.data?"Atualizar":"Cadastrar"," Usu\xE1rio "))},dependencies:[Z,q,J,K,j,Y,L,G,W,H,D,re,se,ae,R,T],styles:[".cadastrar-container[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:700;color:#0b2454}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-body[_ngcontent-%COMP%]{padding-top:.25rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:600;margin-bottom:.35rem;color:#374151}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#f7f9fc;border-radius:.75rem}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field-appearance-outline[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#d1d5db}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%], .cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .mat-mdc-form-field.mat-focused[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%]{border-color:#1d4ed8}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .form-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #e5e7eb;display:flex;gap:1rem;align-items:center}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}.cadastrar-container[_ngcontent-%COMP%]   .contribution-form[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:3rem;border-radius:.625rem;background-color:#0b2454;font-weight:600}@media(max-width:600px){.cadastrar-card[_ngcontent-%COMP%]{padding:1.25rem 1.25rem 1.75rem}}"]})};var fe=(i,t)=>t.id;function ge(i,t){if(i&1&&m(0,"mat-icon",15),i&2){let e=p();c("fontIcon",w(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function Ce(i,t){if(i&1&&m(0,"mat-icon",15),i&2){let e=p();c("fontIcon",w(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function be(i,t){if(i&1&&m(0,"mat-icon",15),i&2){let e=p();c("fontIcon",w(e.sortDirection==="asc"?"arrow_upward":"arrow_downward"))}}function he(i,t){i&1&&(a(0,"tr")(1,"td",21),r(2," Nenhum usu\xE1rio encontrado. "),o()())}function ve(i,t){i&1&&r(0," Administrador ")}function xe(i,t){i&1&&r(0," Tesoureiro(a) ")}function Ue(i,t){i&1&&r(0," Secret\xE1rio(a) ")}function Me(i,t){i&1&&r(0," Conselho Fiscal ")}function Pe(i,t){i&1&&r(0," Presidente ")}function Se(i,t){i&1&&r(0," Usu\xE1rio ")}function Ee(i,t){if(i&1){let e=O();a(0,"tr")(1,"td"),r(2),o(),a(3,"td"),r(4),o(),a(5,"td"),C(6,ve,1,0)(7,xe,1,0)(8,Ue,1,0)(9,Me,1,0)(10,Pe,1,0)(11,Se,1,0),o(),a(12,"td",16)(13,"button",22),d("click",function(){let s=h(e).$implicit,u=p(2);return v(u.editUser(s.id))}),m(14,"mat-icon",23),o(),a(15,"button",24),d("click",function(){let s=h(e).$implicit,u=p(2);return v(u.deleteUser(s.id))}),m(16,"mat-icon",25),o()()()}if(i&2){let e,n=t.$implicit,s=p(2);l(2),N(n.name),l(2),N(n.email),l(2),b((e=n.role)===s.userRoles.ADMIN?6:e===s.userRoles.TREASURER?7:e===s.userRoles.SECRETARY?8:e===s.userRoles.FISCAL?9:e===s.userRoles.PRESIDENT?10:11)}}function Oe(i,t){if(i&1&&F(0,Ee,17,3,"tr",null,fe),i&2){let e=p();A(e.users)}}function ye(i,t){if(i&1){let e=O();a(0,"li",27)(1,"button",30),d("click",function(){let s=h(e).$implicit,u=p(2);return v(u.goToPage(s))}),r(2),o()()}if(i&2){let e=t.$implicit,n=p(2);y("active",n.pageIndex===e),l(2),x(" ",e+1," ")}}function we(i,t){if(i&1){let e=O();a(0,"nav",20)(1,"ul",26)(2,"li",27)(3,"button",28),d("click",function(){h(e);let s=p();return v(s.goToPage(s.pageIndex-1))}),r(4," Anterior "),o()(),F(5,ye,3,3,"li",29,z),a(7,"li",27)(8,"button",28),d("click",function(){h(e);let s=p();return v(s.goToPage(s.pageIndex+1))}),r(9," Pr\xF3xima "),o()()()()}if(i&2){let e=p();l(2),y("disabled",e.pageIndex===0),l(),c("disabled",e.pageIndex===0),l(2),A(e.pages),l(2),y("disabled",e.pageIndex>=e.totalPages-1),l(),c("disabled",e.pageIndex>=e.totalPages-1)}}var pe=class i{usersService=_(M);dialog=_(oe);toastService=_(k);form;users=[];totalUsers=0;pageIndex=0;pageSize=10;sortBy="name";sortDirection="asc";userRoles=I;ngOnInit(){this.getUserList()}openNewUser(){this.dialog.open(P,{width:"720px",maxWidth:"95vw",autoFocus:!1}).afterClosed().subscribe(e=>{e&&this.getUserList()})}getUserList(t=this.pageIndex,e=this.pageSize){let n=t+1;this.usersService.getPaginatedUsers(n,e,this.sortBy,this.sortDirection).pipe(g()).subscribe(s=>{if(!s){this.users=[],this.totalUsers=0;return}this.users=s.data??[],this.totalUsers=s.total??0,this.pageIndex=(s.page??n)-1,this.pageSize=s.limit??e})}get totalPages(){return this.pageSize>0?Math.ceil(this.totalUsers/this.pageSize):0}get pages(){return Array.from({length:this.totalPages},(t,e)=>e)}goToPage(t){t<0||t>=this.totalPages||t===this.pageIndex||(this.pageIndex=t,this.getUserList(this.pageIndex,this.pageSize))}changeSort(t){this.sortBy===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortBy=t,this.sortDirection="asc"),this.pageIndex=0,this.getUserList(0,this.pageSize)}editUser(t){this.usersService.getById(t).pipe(g()).subscribe({next:e=>{this.dialog.open(P,{width:"720px",maxWidth:"95vw",autoFocus:!1,data:e}).afterClosed().subscribe(s=>{s&&this.getUserList()})},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao buscar dados do usu\xE1rio")}})}deleteUser(t){this.dialog.open(me,{width:"400px",data:{title:"Excluir Usu\xE1rio",subtitle:"Tem certeza que deseja excluir este usu\xE1rio?",confirmLabel:"Excluir",cancelLabel:"Cancelar"}}).afterClosed().subscribe(n=>{n&&this.onDeleteUser(t)})}onDeleteUser(t){this.usersService.deleteUser(t).pipe(g()).subscribe({next:()=>{this.toastService.success("Usu\xE1rio exclu\xEDdo com sucesso."),this.getUserList()},error:e=>{this.toastService.error(e.error.error||"Erro desconhecido","Erro ao excluir o usu\xE1rio")}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=E({type:i,selectors:[["app-users"]],decls:41,vars:6,consts:[[1,"contributions","container-fluid","py-4"],[1,"row","align-items-center","mb-4"],[1,"col-12","col-lg"],[1,"h4","mb-1","fw-semibold"],[1,"text-muted","small","mb-0"],[1,"col-12","col-lg-auto"],["type","button",1,"btn","btn-primary","submit-button",3,"click"],["fontIcon","add",1,"submit-icon"],[1,"col-12","mb-4"],[1,"panel","h-100"],[1,"panel-title","mb-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"sortable",3,"click"],[1,"sort-icon",3,"fontIcon"],[1,"text-center"],[1,"row"],[1,"col-12","col-lg-6"],[1,"me-5","mb-3","mt-4"],[1,"mt-3"],["colspan","6",1,"text-center","text-muted","small","py-4"],["aria-label","Editar Usu\xE1rio",1,"rounded-button","me-1",3,"click"],["fontIcon","edit"],["aria-label","Excluir Usu\xE1rio",1,"rounded-button",3,"click"],["fontIcon","delete"],[1,"pagination","justify-content-end","align-items-center","mb-0"],[1,"page-item"],["type","button",1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],["type","button",1,"page-link",3,"click"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Usu\xE1rios"),o(),a(5,"p",4),r(6,"Visualize e gerencie os usu\xE1rios cadastrados"),o()(),a(7,"div",5)(8,"button",6),d("click",function(){return n.openNewUser()}),m(9,"mat-icon",7),r(10," Novo Usu\xE1rio "),o()()(),a(11,"div",8)(12,"mat-card",9)(13,"h2",10),r(14,"Usu\xE1rios"),o(),a(15,"div",11)(16,"table",12)(17,"thead",13)(18,"tr")(19,"th",14),d("click",function(){return n.changeSort("name")}),r(20," Nome "),C(21,ge,1,2,"mat-icon",15),o(),a(22,"th",14),d("click",function(){return n.changeSort("email")}),r(23," Email "),C(24,Ce,1,2,"mat-icon",15),o(),a(25,"th",14),d("click",function(){return n.changeSort("role")}),r(26," Perfil "),C(27,be,1,2,"mat-icon",15),o(),a(28,"th",16),r(29,"A\xE7\xF5es"),o()()(),a(30,"tbody"),C(31,he,3,0,"tr")(32,Oe,2,0),o()()(),a(33,"div",17)(34,"div",18)(35,"p",19)(36,"strong"),r(37,"Total de usu\xE1rios:"),o(),r(38),o()(),a(39,"div",18),C(40,we,10,6,"nav",20),o()()()()()),e&2&&(l(21),b(n.sortBy==="name"?21:-1),l(3),b(n.sortBy==="email"?24:-1),l(3),b(n.sortBy==="role"?27:-1),l(4),b(n.users.length===0?31:32),l(7),x(" ",n.totalUsers),l(2),b(n.totalPages>1?40:-1))},dependencies:[ce,le,ee,R,T,D,te,X],styles:[".contributions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface-container-lowest)}.contributions[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:.625rem;box-shadow:0 1px 1px #0f172a0f;border:1px solid rgba(148,163,184,.25);background-color:#fff}.contributions[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600}.contributions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:2.5rem;margin-top:1.75rem}.contributions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{border-radius:.625rem;background-color:#0b2454;font-weight:600}.contributions[_ngcontent-%COMP%]   .cancel-button[_ngcontent-%COMP%]{color:#6b7280}"]})};export{pe as UsersComponent};
