<!-- Filtros -->
<div class="row mb-3">
  <div class="col-lg-3">
    <label for="memberId" class="form-label">Membro</label>
    <select class="form-control" [(ngModel)]="memberId">
      <option [value]="null" disabled selected>- Selecione</option>
      @for ((member of members$ | async); track $index) {
        <option [value]="member.id">{{ member.name }}</option>
      }
    </select>
  </div>

  <div class="col-lg-3">
    <label for="contributionTypeId" class="form-label">Tipo de Contribuição</label>
    <select class="form-control" [(ngModel)]="contributionTypeId">
      <option [value]="null" disabled selected>- Selecione</option>
      @for ((type of contributionTypes$ | async); track $index) {
        <option [value]="type.id">{{ type.description }}</option>
      }
    </select>
  </div>

  <div class="col-lg-3">
    <label for="paymentMethodId" class="form-label">Método de Pagamento</label>
    <select class="form-control" [(ngModel)]="paymentMethodId">
      <option [value]="null" disabled selected>- Selecione</option>
      @for ((method of paymentMethods$ | async); track $index) {
        <option [value]="method.id">{{ method.type }}</option>
      }
    </select>
  </div>

  <div class="col-lg-3">
    <button type="submit" class="btn btn-primary submit-button" (click)="getContributionList()">
      <mat-icon fontIcon="search" class="submit-icon"></mat-icon> Pesquisar
    </button>
    <button type="submit" class="btn cancel-button" (click)="limpar()">
      <mat-icon fontIcon="clear" class="submit-icon"></mat-icon> Limpar
    </button>
  </div>
</div>

<hr />

<div class="table-responsive">
  <table class="table table-striped table-hover align-middle mb-0">
    <thead class="table-light">
      <tr>
        <th (click)="changeSort('date')" class="sortable">
          Data
          @if (sortBy === 'date') {
            <mat-icon
              class="sort-icon"
              fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
            ></mat-icon>
          }
        </th>
        <th (click)="changeSort('memberId')" class="sortable">
          Membro
          @if (sortBy === 'memberId') {
            <mat-icon
              class="sort-icon"
              fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
            ></mat-icon>
          }
        </th>
        <th (click)="changeSort('contributionTypeId')" class="sortable">
          Tipo
          @if (sortBy === 'contributionTypeId') {
            <mat-icon
              class="sort-icon"
              fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
            ></mat-icon>
          }
        </th>
        <th (click)="changeSort('paymentMethodId')" class="sortable">
          Pagamento
          @if (sortBy === 'paymentMethodId') {
            <mat-icon
              class="sort-icon"
              fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
            ></mat-icon>
          }
        </th>
        <th (click)="changeSort('amount')" class="sortable">
          Valor
          @if (sortBy === 'amount') {
            <mat-icon
              class="sort-icon"
              fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
            ></mat-icon>
          }
        </th>
        <!-- <th class="text-end">Ações</th> -->
      </tr>
    </thead>
    <tbody>
      @if (contributions.length === 0) {
        <tr>
          <td colspan="6" class="text-center text-muted small py-4">
            Nenhuma contribuição encontrada.
          </td>
        </tr>
      } @else {
        @for (item of contributions; track item.id) {
          <tr>
            <td>{{ item.date | date: 'shortDate' : 'pt-BR' }}</td>
            <td>{{ item.member?.name ?? '-' }}</td>
            <td>{{ item.contributionType.description }}</td>
            <td>{{ item.paymentMethod.type }}</td>
            <td>
              {{ normalizeAmount(item.amount) | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}
            </td>
            <!-- <td class="text-end"></td> -->
          </tr>
        }
      }
    </tbody>
  </table>
</div>

@if (totalPages > 1) {
  <nav class="mt-3">
    <ul class="pagination justify-content-end align-items-center mb-0">
      <li class="me-5"><strong>Total de contribuições:</strong> {{ totalContributions }}</li>
      <li class="page-item" [class.disabled]="pageIndex === 0">
        <button
          class="page-link"
          type="button"
          (click)="goToPage(pageIndex - 1)"
          [disabled]="pageIndex === 0"
        >
          Anterior
        </button>
      </li>

      @for (page of pages; track page) {
        <li class="page-item" [class.active]="pageIndex === page">
          <button class="page-link" type="button" (click)="goToPage(page)">
            {{ page + 1 }}
          </button>
        </li>
      }

      <li class="page-item" [class.disabled]="pageIndex >= totalPages - 1">
        <button
          class="page-link"
          type="button"
          (click)="goToPage(pageIndex + 1)"
          [disabled]="pageIndex >= totalPages - 1"
        >
          Próxima
        </button>
      </li>
    </ul>
  </nav>
}
