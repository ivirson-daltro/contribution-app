@let dashboardSummary = dashboardSummary$ | async;
@let dashboardSummaryChart = dashboardSummaryChart$ | async;

<div class="dashboard container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h4 mb-1 fw-semibold">Dashboard</h1>
      <p class="text-muted small mb-0">Visão geral das contribuições da igreja</p>
    </div>
  </div>

  <!-- Cards de resumo -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        [title]="'Total da Semana'"
        [subtitle]="dashboardSummary?.totalWeeklyContributions + ' contribuições'"
        [amount]="
          (dashboardSummary?.totalWeeklyAmount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ??
          0
        "
        iconSrc="icons/calendar.svg"
        iconAlt="Ícone de calendário"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        [title]="'Total do Mês'"
        [subtitle]="dashboardSummary?.totalMonthlyContributions + ' contribuições'"
        [amount]="
          (dashboardSummary?.totalMonthlyAmount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ??
          0
        "
        iconSrc="icons/trending.svg"
        iconAlt="Ícone de tendência"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        [title]="'Total Geral'"
        [subtitle]="dashboardSummary?.totalContributions + ' contribuições'"
        [amount]="
          (dashboardSummary?.totalAmount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        iconSrc="icons/dollar.svg"
        iconAlt="Ícone de cifrão"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        [title]="'Membros Ativos'"
        [subtitle]="dashboardSummary?.totalMembersContributing + ' membros contribuintes'"
        [amount]="dashboardSummary?.totalMembers ?? 0"
        iconSrc="icons/users.svg"
        iconAlt="Ícone de usuários"
      />
    </div>
  </div>

  <div class="col-12 mb-4">
    <mat-card class="panel h-100">
      <h2 class="panel-title mb-3">Formas de Pagamento</h2>
      <div class="row">
        @for (item of dashboardSummary?.contributionsByPaymentMethod; track $index) {
          <div class="col-12 col-lg-6">
            <div class="payment-card mb-2 py-3">
              <div>
                <div class="payment-title">{{ item.type }}</div>
                <div class="payment-subtitle">{{ item.description }}</div>
              </div>
              <div class="payment-amount">
                {{ item.total | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}
              </div>
            </div>
          </div>
        }
      </div>
    </mat-card>
  </div>

  <!-- Gráficos -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-lg-6">
      <mat-card class="panel h-100">
        <h2 class="panel-title mb-3">Distribuição por Forma de pagamento</h2>
        <div class="d-flex justify-content-end align-items-center mb-3">
          <div class="btn-group" role="group" aria-label="Período do gráfico de pagamentos">
            <button
              mat-stroked-button
              class="period-toggle-btn me-2"
              type="button"
              (click)="setPaymentPeriod('weekly')"
            >
              Semana atual
            </button>
            <button
              mat-stroked-button
              class="period-toggle-btn"
              type="button"
              (click)="setPaymentPeriod('monthly')"
            >
              Mês atual
            </button>
          </div>
        </div>

        <app-payment-method-chart
          [totals]="dashboardSummaryChart"
          [period]="selectedPaymentPeriod"
        />
      </mat-card>
    </div>

    <div class="col-12 col-lg-6">
      <mat-card class="panel h-100">
        <h2 class="panel-title mb-5">Contribuições por mês</h2>

        <app-monthly-contributions-chart
          [currentYear]="dashboardSummary?.currentYearContributionsByMonth"
          [lastYear]="dashboardSummary?.lastYearContributionsByMonth"
        />
      </mat-card>
    </div>
  </div>
</div>
