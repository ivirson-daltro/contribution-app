@let dashboardSummary = dashboardSummary$ | async;
@let dashboardSummaryChart = dashboardSummaryChart$ | async;

<div class="dashboard container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h4 mb-1 fw-semibold">Dashboard</h1>
      <p class="text-muted small mb-0">Visão geral das contribuições da igreja</p>
    </div>
  </div>

  <!-- Cards de resumo -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Entradas do Mês"
        [subtitle]="
          dashboardSummary?.totalMonthlyContributions +
          (dashboardSummary?.totalMonthlyContributions === 1 ? ' contribuição' : ' contribuições')
        "
        [amount]="
          (dashboardSummary?.totalMonthlyAmount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ??
          0
        "
        icon="trending_up"
        bg="rgba(59,165,93,0.08)"
        iconBg="rgba(59,165,93,0.18)"
        iconColor="#3BA55D"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Saídas do mês"
        [subtitle]="
          dashboardSummary?.totalMonthlyExpensesCount +
          (dashboardSummary?.totalMonthlyExpensesCount === 1 ? ' pagamento' : ' pagamentos')
        "
        [amount]="
          (dashboardSummary?.totalMonthlyExpenses
            | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        icon="trending_down"
        bg="rgba(214,69,69,0.06)"
        iconBg="rgba(214,69,69,0.15)"
        iconColor="#D64545"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Saldo do mês"
        [amount]="
          ((dashboardSummary?.totalMonthlyAmount ?? 0) -
            (dashboardSummary?.totalMonthlyExpenses ?? 0)
            | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        icon="monetization_on"
        bg="rgba(15,45,92,0.06)"
        iconBg="rgba(15,45,92,0.15)"
        iconColor="#0F2D5C"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Ofertas de Construção"
        [subtitle]="
          dashboardSummary?.totalConstructionOffers +
          (dashboardSummary?.totalConstructionOffers === 1 ? ' oferta' : ' ofertas')
        "
        [amount]="
          (dashboardSummary?.totalConstructionOfferAmount
            | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        icon="apartment"
        bg="rgba(212,175,55,0.08)"
        iconBg="rgba(212,175,55,0.20)"
        iconColor="#D4AF37"
      />
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Entradas da Semana"
        [subtitle]="
          dashboardSummary?.totalWeeklyContributions +
          (dashboardSummary?.totalWeeklyContributions === 1 ? ' contribuição' : ' contribuições')
        "
        [amount]="
          (dashboardSummary?.totalWeeklyAmount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ??
          0
        "
        icon="trending_up"
        bg="rgba(59,165,93,0.08)"
        iconBg="rgba(59,165,93,0.18)"
        iconColor="#3BA55D"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Saídas da semana"
        [subtitle]="
          dashboardSummary?.totalWeeklyExpensesCount +
          (dashboardSummary?.totalWeeklyExpensesCount === 1 ? ' pagamento' : ' pagamentos')
        "
        [amount]="
          (dashboardSummary?.totalWeeklyExpenses
            | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        icon="trending_down"
        bg="rgba(214,69,69,0.04)"
        iconBg="rgba(214,69,69,0.12)"
        iconColor="#D64545"
      />
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Membros Ativos"
        [subtitle]="dashboardSummary?.totalMembersContributing + ' membros contribuintes'"
        [amount]="dashboardSummary?.totalMembers ?? 0"
        icon="groups"
        bg="rgba(212,175,55,0.08)"
        iconBg="rgba(212,175,55,0.20)"
        iconColor="#D4AF37"
      />
    </div>

    <!-- <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Entradas do ano"
        [subtitle]="
          dashboardSummary?.totalContributions +
          (dashboardSummary?.totalContributions === 1 ? ' contribuição' : ' contribuições')
        "
        [amount]="
          (dashboardSummary?.totalAmount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        icon="monetization_on"
      />
    </div> -->

    <!-- <div class="col-12 col-md-6 col-xl-3">
      <app-summary-card
        title="Saídas do ano"
        [subtitle]="
          dashboardSummary?.totalYearlyExpensesCount +
          (dashboardSummary?.totalYearlyExpensesCount === 1 ? ' pagamento' : ' pagamentos')
        "
        [amount]="
          (dashboardSummary?.totalYearlyExpenses
            | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR') ?? 0
        "
        icon="trending_down"
      />
    </div> -->
  </div>

  <div class="col-12 mb-4">
    <mat-card class="panel h-100">
      <h2 class="panel-title mb-3">Formas de Pagamento</h2>
      <div class="row">
        @for (item of dashboardSummary?.contributionsByPaymentMethod; track $index) {
          <div class="col-12 col-lg-6">
            <div class="payment-card mb-2 py-3">
              <div>
                <div class="payment-title">{{ item.type }}</div>
                <div class="payment-subtitle">{{ item.description }}</div>
              </div>
              <div class="payment-amount">
                {{ item.total | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}
              </div>
            </div>
          </div>
        }
      </div>
    </mat-card>
  </div>

  <!-- Gráficos -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-lg-6">
      <mat-card class="panel h-100">
        <h2 class="panel-title mb-3">Distribuição das entradas por forma de pagamento</h2>
        <div class="d-flex justify-content-end align-items-center mb-3">
          <div class="btn-group" role="group" aria-label="Período do gráfico de pagamentos">
            <button
              mat-stroked-button
              class="period-toggle-btn me-2"
              type="button"
              (click)="setPaymentPeriod(weekType.LAST_WEEK)"
            >
              Semana anterior
            </button>
            <button
              mat-stroked-button
              class="period-toggle-btn"
              type="button"
              (click)="setPaymentPeriod(weekType.CURRENT_WEEK)"
            >
              Semana atual
            </button>
          </div>
        </div>

        <app-payment-method-chart
          [totals]="dashboardSummaryChart"
          [period]="selectedPaymentPeriod"
        />
      </mat-card>
    </div>

    <div class="col-12 col-lg-6">
      <mat-card class="panel h-100">
        <h2 class="panel-title mb-5">Entradas x Saídas por mês</h2>

        <app-monthly-contributions-chart
          [monthlyData]="dashboardSummary?.currentYearContributionsByMonth"
        />
      </mat-card>
    </div>
  </div>
</div>
