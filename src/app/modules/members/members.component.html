<div class="contributions container-fluid py-4">
  <div class="row align-items-center mb-4">
    <div class="col-12 col-lg">
      <h1 class="h4 mb-1 fw-semibold">Membros</h1>
      <p class="text-muted small mb-0">Visualize e gerencie os membros cadastrados</p>
    </div>
    <div class="col-12 col-lg-auto">
      <button type="button" class="btn btn-primary submit-button" (click)="openNewMember()">
        <mat-icon fontIcon="add" class="submit-icon"></mat-icon> Novo Membro
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="col-12 mb-4">
    <mat-card class="panel h-100">
      <h2 class="panel-title mb-3 d-flex align-items-center">
        <mat-icon fontIcon="filter_alt" class="me-2"></mat-icon> Filtros
      </h2>
      <div class="row mb-2">
        <div class="col-12 col-lg-5 mb-3">
          <label for="name" class="form-label">Nome</label>
          <input
            class="form-control"
            [(ngModel)]="name"
            placeholder="Digite um nome ou parte de um nome para filtrar"
          />
        </div>

        <div class="col-12 col-lg-7 text-end">
          <button type="button" class="btn cancel-button" (click)="limpar()">
            <mat-icon fontIcon="clear" class="submit-icon"></mat-icon> Limpar
          </button>
          <button
            type="submit"
            class="btn btn-primary submit-button"
            (click)="searchByName()"
            [disabled]="!name"
          >
            <mat-icon fontIcon="search" class="submit-icon"></mat-icon> Pesquisar
          </button>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Grid -->
  <div class="col-12 mb-4">
    <mat-card class="panel h-100">
      <h2 class="panel-title mb-3">Membros</h2>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th (click)="changeSort('name')" class="sortable">
                Nome
                @if (sortBy === 'name') {
                  <mat-icon
                    class="sort-icon"
                    fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
                  ></mat-icon>
                }
              </th>
              <th>Tipo de Membro</th>
              <th>Telefone</th>
              <th>E-mail</th>
              <th>Data de Nascimento</th>
              @if (
                user?.role === userRoles.ADMIN ||
                user?.role === userRoles.TREASURER ||
                user?.role === userRoles.SECRETARY
              ) {
                <th class="text-center">Ações</th>
              }
            </tr>
          </thead>
          <tbody>
            @if (members.length === 0) {
              <tr>
                <td colspan="6" class="text-center text-muted small py-4">
                  Nenhum membro encontrado.
                </td>
              </tr>
            } @else {
              @for (item of members; track item.id) {
                <tr>
                  <td>{{ item.name }}</td>
                  <td>{{ item.memberType.description }}</td>
                  <td>{{ item.phone ?? '' | mask: '(00) 0 0000-0000' }}</td>
                  <td>{{ item.email }}</td>
                  <td>{{ item.birthDate | date: 'dd/MM/yyyy' }}</td>
                  @if (
                    user?.role === userRoles.ADMIN ||
                    user?.role === userRoles.TREASURER ||
                    user?.role === userRoles.SECRETARY
                  ) {
                    <td class="text-center">
                      <button
                        class="rounded-button me-1"
                        aria-label="Editar Membro"
                        (click)="editMember(item.id)"
                      >
                        <mat-icon fontIcon="edit"></mat-icon>
                      </button>
                      <button
                        class="rounded-button"
                        aria-label="Excluir Membro"
                        (click)="deleteMember(item.id)"
                      >
                        <mat-icon fontIcon="delete"></mat-icon>
                      </button>
                    </td>
                  }
                </tr>
              }
            }
          </tbody>
        </table>
      </div>

      <div class="row">
        <div class="col-12 col-lg-6">
          <p class="me-5 mb-3 mt-4"><strong>Total de membros:</strong> {{ totalMembers }}</p>
        </div>
        <div class="col-12 col-lg-6">
          @if (totalPages > 1) {
            <nav class="mt-3">
              <ul class="pagination justify-content-end align-items-center mb-0">
                <li class="page-item" [class.disabled]="pageIndex === 0">
                  <button
                    class="page-link"
                    type="button"
                    (click)="goToPage(pageIndex - 1)"
                    [disabled]="pageIndex === 0"
                  >
                    Anterior
                  </button>
                </li>

                @for (page of pages; track page) {
                  <li class="page-item" [class.active]="pageIndex === page">
                    <button class="page-link" type="button" (click)="goToPage(page)">
                      {{ page + 1 }}
                    </button>
                  </li>
                }

                <li class="page-item" [class.disabled]="pageIndex >= totalPages - 1">
                  <button
                    class="page-link"
                    type="button"
                    (click)="goToPage(pageIndex + 1)"
                    [disabled]="pageIndex >= totalPages - 1"
                  >
                    Próxima
                  </button>
                </li>
              </ul>
            </nav>
          }
        </div>
      </div>
    </mat-card>
  </div>
</div>
