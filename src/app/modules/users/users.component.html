<div class="contributions container-fluid py-4">
  <div class="row align-items-center mb-4">
    <div class="col-12 col-lg">
      <h1 class="h4 mb-1 fw-semibold">Usuários</h1>
      <p class="text-muted small mb-0">Visualize e gerencie os usuários cadastrados</p>
    </div>
    <div class="col-12 col-lg-auto">
      <button type="button" class="btn btn-primary submit-button" (click)="openNewUser()">
        <mat-icon fontIcon="add" class="submit-icon"></mat-icon> Novo Usuário
      </button>
    </div>
  </div>

  <!-- Grid -->
  <div class="col-12 mb-4">
    <mat-card class="panel h-100">
      <h2 class="panel-title mb-3">Usuários</h2>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th (click)="changeSort('name')" class="sortable">
                Nome
                @if (sortBy === 'name') {
                  <mat-icon
                    class="sort-icon"
                    fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
                  ></mat-icon>
                }
              </th>
              <th (click)="changeSort('email')" class="sortable">
                Email
                @if (sortBy === 'email') {
                  <mat-icon
                    class="sort-icon"
                    fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
                  ></mat-icon>
                }
              </th>
              <th (click)="changeSort('role')" class="sortable">
                Perfil
                @if (sortBy === 'role') {
                  <mat-icon
                    class="sort-icon"
                    fontIcon="{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}"
                  ></mat-icon>
                }
              </th>
              <th class="text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            @if (users.length === 0) {
              <tr>
                <td colspan="6" class="text-center text-muted small py-4">
                  Nenhum usuário encontrado.
                </td>
              </tr>
            } @else {
              @for (item of users; track item.id) {
                <tr>
                  <td>{{ item.name }}</td>
                  <td>{{ item.email }}</td>
                  <td>{{ item.role === 'ADMIN' ? 'Administrador' : 'Usuário' }}</td>
                  <td class="text-center">
                    <button
                      class="rounded-button me-1"
                      aria-label="Editar Usuário"
                      (click)="editUser(item.id)"
                    >
                      <mat-icon fontIcon="edit"></mat-icon>
                    </button>
                    <button
                      class="rounded-button"
                      aria-label="Excluir Usuário"
                      (click)="deleteUser(item.id)"
                    >
                      <mat-icon fontIcon="delete"></mat-icon>
                    </button>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>

      <div class="row">
        <div class="col-12 col-lg-6">
          <p class="me-5 mb-3 mt-4"><strong>Total de usuários:</strong> {{ totalUsers }}</p>
        </div>
        <div class="col-12 col-lg-6">
          @if (totalPages > 1) {
            <nav class="mt-3">
              <ul class="pagination justify-content-end align-items-center mb-0">
                <li class="page-item" [class.disabled]="pageIndex === 0">
                  <button
                    class="page-link"
                    type="button"
                    (click)="goToPage(pageIndex - 1)"
                    [disabled]="pageIndex === 0"
                  >
                    Anterior
                  </button>
                </li>

                @for (page of pages; track page) {
                  <li class="page-item" [class.active]="pageIndex === page">
                    <button class="page-link" type="button" (click)="goToPage(page)">
                      {{ page + 1 }}
                    </button>
                  </li>
                }

                <li class="page-item" [class.disabled]="pageIndex >= totalPages - 1">
                  <button
                    class="page-link"
                    type="button"
                    (click)="goToPage(pageIndex + 1)"
                    [disabled]="pageIndex >= totalPages - 1"
                  >
                    Próxima
                  </button>
                </li>
              </ul>
            </nav>
          }
        </div>
      </div>
    </mat-card>
  </div>
</div>
